# ğŸ¯ ìŒì„± AI ê±´ê°•ì£¼ì¹˜ì˜ ì•± - Claude Code ê°œë°œ ê°€ì´ë“œ (ì „ì²´)

**ë²„ì „:** 1.0  
**ì‘ì„±ì¼:** 2025ë…„ 12ì›” 5ì¼  
**ëŒ€ìƒ:** Claude Codeë¥¼ ì‚¬ìš©í•˜ëŠ” ê°œë°œì  
**ì°¸ì¡° ë¬¸ì„œ:** PRD v1.2, TRD v1.2, AIìºë¦­í„° ê°€ì´ë“œ v1.1, ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸ v1.2

---

## ğŸ“š ëª©ì°¨

1. [ì‹œì‘ ì „ í•„ìˆ˜ ì‘ì—…](#1-ì‹œì‘-ì „-í•„ìˆ˜-ì‘ì—…)
2. [Phase 1: MVP ê°œë°œ (8ì£¼, 56ì¼)](#2-phase-1-mvp-ê°œë°œ-8ì£¼-56ì¼)
   - Week 1: ì¸í”„ë¼ ì„¤ì • ë° ì¸ì¦ (Day 1-8)
   - Week 2: ì‚¬ìš©ì & ê°€ì¡± ê´€ë¦¬ (Day 9-16)
   - Week 3-4: ìŒì„± ìƒë‹´ ì‹œìŠ¤í…œ (Day 17-25)
   - Week 4-5: ì›¨ì–´ëŸ¬ë¸” & ê±´ê°• ë°ì´í„° (Day 26-34)
   - Week 6-7: êµ¬ë… & UI (Day 35-52)
   - Week 8: ë°°í¬ ì¤€ë¹„ (Day 53-56)
3. [Phase 1.5: ì•„ì¹¨ ë£¨í‹´ ê¸°ëŠ¥ (1ì£¼)](#3-phase-15-ì•„ì¹¨-ë£¨í‹´-ê¸°ëŠ¥-1ì£¼)
4. [Phase 2: ë² íƒ€ í…ŒìŠ¤íŠ¸ (2ì£¼)](#4-phase-2-ë² íƒ€-í…ŒìŠ¤íŠ¸-2ì£¼)
5. [Phase 3: ì •ì‹ ì¶œì‹œ](#5-phase-3-ì •ì‹-ì¶œì‹œ)
6. [Phase 4: ê³ ë„í™” (6ì£¼)](#6-phase-4-ê³ ë„í™”-6ì£¼)
7. [Phase 5: í™•ì¥ (6ì£¼)](#7-phase-5-í™•ì¥-6ì£¼)
8. [ë¶€ë¡: ìœ ìš©í•œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿](#8-ë¶€ë¡-ìœ ìš©í•œ-í”„ë¡¬í”„íŠ¸-í…œí”Œë¦¿)

---

## 1. ì‹œì‘ ì „ í•„ìˆ˜ ì‘ì—…

### ğŸ¬ í”„ë¡œì íŠ¸ ì´ˆê¸°í™” í”„ë¡¬í”„íŠ¸

```markdown
# í”„ë¡œì íŠ¸ ì‹œì‘ - ë¬¸ì„œ ë¡œë”©

ì•ˆë…•! ìŒì„± AI ê±´ê°•ì£¼ì¹˜ì˜ ì•±ì„ ê°œë°œí•  ê±°ì•¼.

## í•„ìˆ˜ ë¬¸ì„œ ì½ê¸°
ë‹¤ìŒ 4ê°œ ë¬¸ì„œë¥¼ ë¨¼ì € ì½ê³  ì™„ì „íˆ ì´í•´í•´ì¤˜:

1. /mnt/user-data/outputs/ìŒì„±AIê±´ê°•ì£¼ì¹˜ì˜ì•±_PRD_v1.2.md
2. /mnt/user-data/outputs/ìŒì„±AIê±´ê°•ì£¼ì¹˜ì˜ì•±_TRD_v1.2.md
3. /mnt/user-data/outputs/AIìºë¦­í„°_ì‹œìŠ¤í…œí”„ë¡¬í”„íŠ¸_ê°€ì´ë“œ_v1.1.md
4. /mnt/user-data/outputs/ê°œë°œ_ì²´í¬ë¦¬ìŠ¤íŠ¸_v1.2.md

## í”„ë¡œì íŠ¸ ê°œìš”
- **ëª©í‘œ:** 40-60ëŒ€ë¥¼ ìœ„í•œ ê°€ì¡± ì¤‘ì‹¬ ìŒì„± AI ê±´ê°• ê´€ë¦¬ ì•±
- **ì•„í‚¤í…ì²˜:** í†µí•© ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ (Core API + Conversation Service)
- **ë°°í¬:** Fly.io (í™ì½© ë¦¬ì „)
- **ê¸°ê°„:** 8ì£¼ MVP + 1ì£¼ ë£¨í‹´ + 2ì£¼ ë² íƒ€ í…ŒìŠ¤íŠ¸
- **ì¶œì‹œ:** 2026ë…„ 2ì›” 12ì¼

## ê¸°ìˆ  ìŠ¤íƒ
- Backend: Python 3.11, FastAPI, SQLAlchemy
- Database: PostgreSQL 15, Redis 7, Chroma DB
- AI: OpenAI Realtime API (gpt-realtime-2025-08-28)
- Frontend: Flutter 3.24+
- Deployment: Fly.io (í™ì½©), Cloudflare R2

## ê°œë°œ ì›ì¹™
1. TRD ìŠ¤í™ì„ 100% ì •í™•íˆ ë”°ë¥¼ ê²ƒ
2. ê° Dayë³„ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ìˆœì„œëŒ€ë¡œ ì™„ë£Œí•  ê²ƒ
3. í…ŒìŠ¤íŠ¸ ìš°ì„  ê°œë°œ (TDD)
4. ì½”ë“œ ì‘ì„± í›„ ë°˜ë“œì‹œ ë¡œì»¬ í…ŒìŠ¤íŠ¸
5. ê° Day ì™„ë£Œ ì‹œ ë³´ê³ ì„œ ì‘ì„±

ë¬¸ì„œë¥¼ ëª¨ë‘ ì½ì—ˆìœ¼ë©´ ë‹¤ìŒì„ ë‹µë³€í•´ì¤˜:
1. "ë¬¸ì„œ ì´í•´ ì™„ë£Œ"
2. í”„ë¡œì íŠ¸ì˜ í•µì‹¬ ëª©í‘œ 3ê°€ì§€ ìš”ì•½
3. í†µí•© ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ êµ¬ì¡° (2ê°œ ì„œë¹„ìŠ¤) ì„¤ëª…
4. ì¤€ë¹„ ì™„ë£Œ ì„ ì–¸: "Day 1ë¶€í„° ì‹œì‘í•  ì¤€ë¹„ê°€ ëìŠµë‹ˆë‹¤!"
```

---

## 2. Phase 1: MVP ê°œë°œ (8ì£¼, 56ì¼)

### ğŸ”¹ Week 1: ì¸í”„ë¼ ì„¤ì • ë° ì¸ì¦ (Day 1-8)

#### Day 1-2: í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì •

```markdown
# Day 1-2: í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì •

## ëª©í‘œ
ë°±ì—”ë“œ í”„ë¡œì íŠ¸ êµ¬ì¡°ë¥¼ ìƒì„±í•˜ê³  ë¡œì»¬ ê°œë°œ í™˜ê²½ì„ êµ¬ì¶•í•©ë‹ˆë‹¤.

## ì°¸ì¡°
- ê°œë°œ_ì²´í¬ë¦¬ìŠ¤íŠ¸_v1.2.md: Day 1-2
- TRD v1.2: ì„¹ì…˜ 2.3 (Core API ë‚´ë¶€ êµ¬ì¡°)
- TRD v1.2: ì„¹ì…˜ 10.1 (ê°œë°œ í™˜ê²½)

## ì‘ì—… ìœ„ì¹˜
/home/claude/healthai-backend

## ìš”êµ¬ì‚¬í•­

### 1. í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒì„±
ë‹¤ìŒ êµ¬ì¡°ë¥¼ ì •í™•íˆ ìƒì„±í•´ì¤˜:

```
healthai-backend/
â”œâ”€â”€ core_api/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ config.py
â”‚   â”œâ”€â”€ database.py
â”‚   â”œâ”€â”€ dependencies.py
â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”œâ”€â”€ users.py
â”‚   â”‚   â”œâ”€â”€ families.py
â”‚   â”‚   â”œâ”€â”€ routines.py
â”‚   â”‚   â”œâ”€â”€ subscriptions.py
â”‚   â”‚   â”œâ”€â”€ characters.py
â”‚   â”‚   â””â”€â”€ wearables.py
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”œâ”€â”€ family.py
â”‚   â”‚   â”œâ”€â”€ conversation.py
â”‚   â”‚   â”œâ”€â”€ routine.py
â”‚   â”‚   â””â”€â”€ subscription.py
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”œâ”€â”€ family.py
â”‚   â”‚   â”œâ”€â”€ routine.py
â”‚   â”‚   â””â”€â”€ subscription.py
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ auth_service.py
â”‚       â”œâ”€â”€ user_service.py
â”‚       â”œâ”€â”€ family_service.py
â”‚       â”œâ”€â”€ routine_service.py
â”‚       â””â”€â”€ wearable_service.py
â”œâ”€â”€ conversation_service/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ config.py
â”‚   â”œâ”€â”€ realtime.py
â”‚   â”œâ”€â”€ websocket.py
â”‚   â”œâ”€â”€ rag.py
â”‚   â””â”€â”€ characters.py
â”œâ”€â”€ alembic/
â”‚   â”œâ”€â”€ env.py
â”‚   â”œâ”€â”€ script.py.mako
â”‚   â””â”€â”€ versions/
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py
â”‚   â”œâ”€â”€ test_auth.py
â”‚   â”œâ”€â”€ test_users.py
â”‚   â”œâ”€â”€ test_families.py
â”‚   â””â”€â”€ test_routines.py
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ seed_data.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ Dockerfile.core
â”œâ”€â”€ Dockerfile.conversation
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ fly.core.toml
â”œâ”€â”€ fly.conversation.toml
â”œâ”€â”€ alembic.ini
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ pytest.ini
â””â”€â”€ README.md
```

### 2. requirements.txt ì‘ì„±
TRD v1.2 ì„¹ì…˜ 3.2ì˜ ë°±ì—”ë“œ ìŠ¤íƒ ì°¸ì¡°:

```
# FastAPI & Server
fastapi==0.115.0
uvicorn[standard]==0.30.0
python-multipart==0.0.9

# Database
sqlalchemy==2.0.31
alembic==1.14.0
psycopg2-binary==2.9.9

# Redis & Caching
redis==5.0.7

# Data Validation
pydantic==2.9.0
pydantic-settings==2.4.0

# Authentication & Security
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
cryptography==42.0.8

# HTTP Client
aiohttp==3.10.0
httpx==0.27.0

# OpenAI & AI
openai==1.54.0
chromadb==0.5.3
tiktoken==0.7.0

# Testing
pytest==8.3.0
pytest-asyncio==0.24.0
pytest-cov==5.0.0

# Utilities
python-dotenv==1.0.1
```

### 3. docker-compose.yml
TRD v1.2 ì„¹ì…˜ 10.1 ì°¸ì¡°:

```yaml
version: '3.8'

services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_USER: healthai
      POSTGRES_PASSWORD: password
      POSTGRES_DB: healthai_db
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U healthai"]
      interval: 5s
      timeout: 5s
      retries: 5
  
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 5s
      timeout: 3s
      retries: 5
  
  core_api:
    build:
      context: .
      dockerfile: Dockerfile.core
    ports:
      - "8000:8000"
    environment:
      DATABASE_URL: postgresql://healthai:password@postgres:5432/healthai_db
      REDIS_URL: redis://redis:6379
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      ENVIRONMENT: development
      LOG_LEVEL: debug
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./core_api:/app/core_api
      - ./alembic:/app/alembic
      - ./scripts:/app/scripts
    command: uvicorn core_api.main:app --host 0.0.0.0 --port 8000 --reload
  
  conversation:
    build:
      context: .
      dockerfile: Dockerfile.conversation
    ports:
      - "8004:8004"
    environment:
      DATABASE_URL: postgresql://healthai:password@postgres:5432/healthai_db
      REDIS_URL: redis://redis:6379
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      ENVIRONMENT: development
      LOG_LEVEL: debug
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./conversation_service:/app/conversation_service
    command: uvicorn conversation_service.main:app --host 0.0.0.0 --port 8004 --reload

volumes:
  postgres_data:
```

### 4. Dockerfile.core

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
RUN apt-get update && apt-get install -y \
    gcc \
    postgresql-client \
    && rm -rf /var/lib/apt/lists/*

# Python íŒ¨í‚¤ì§€ ì„¤ì¹˜
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ì•± ì½”ë“œ ë³µì‚¬
COPY core_api/ ./core_api/
COPY alembic/ ./alembic/
COPY alembic.ini .
COPY scripts/ ./scripts/

EXPOSE 8000

# í—¬ìŠ¤ì²´í¬
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD python -c "import requests; requests.get('http://localhost:8000/health')"

CMD ["uvicorn", "core_api.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### 5. Dockerfile.conversation

```dockerfile
FROM python:3.11-slim

WORKDIR /app

RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY conversation_service/ ./conversation_service/

EXPOSE 8004

HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD python -c "import requests; requests.get('http://localhost:8004/health')"

CMD ["uvicorn", "conversation_service.main:app", "--host", "0.0.0.0", "--port", "8004"]
```

### 6. .env.example

```bash
# Database
DATABASE_URL=postgresql://healthai:password@postgres:5432/healthai_db

# Redis
REDIS_URL=redis://redis:6379

# JWT
JWT_SECRET_KEY=your-secret-key-change-this-in-production
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=14

# OpenAI
OPENAI_API_KEY=sk-your-key-here

# OAuth (ì¶”í›„ ì„¤ì •)
KAKAO_CLIENT_ID=
KAKAO_CLIENT_SECRET=
KAKAO_REDIRECT_URI=http://localhost:8000/api/v1/auth/callback/kakao

GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI=http://localhost:8000/api/v1/auth/callback/google

APPLE_CLIENT_ID=
APPLE_TEAM_ID=
APPLE_KEY_ID=
APPLE_PRIVATE_KEY_PATH=

# Environment
ENVIRONMENT=development
LOG_LEVEL=info

# Chroma DB (ì¶”í›„ ì„¤ì •)
CHROMA_HOST=localhost
CHROMA_PORT=8001
```

### 7. .gitignore

```
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
env/
venv/
ENV/
.venv/

# IDEs
.vscode/
.idea/
*.swp
*.swo

# Environment
.env
.env.local

# Database
*.db
*.sqlite

# Testing
.coverage
htmlcov/
.pytest_cache/

# Docker
*.log

# OS
.DS_Store
Thumbs.db

# Alembic
alembic/versions/*_test.py
```

### 8. pytest.ini

```ini
[pytest]
testpaths = tests
python_files = test_*.py
python_functions = test_*
asyncio_mode = auto
```

### 9. alembic.ini

```ini
[alembic]
script_location = alembic
prepend_sys_path = .
version_path_separator = os

sqlalchemy.url = postgresql://healthai:password@localhost:5432/healthai_db

[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console

[formatters]
keys = generic

[logger_root]
level = WARN
handlers = console
qualname =

[logger_sqlalchemy]
level = WARN
handlers =
qualname = sqlalchemy.engine

[logger_alembic]
level = INFO
handlers =
qualname = alembic

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[formatter_generic]
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S
```

### 10. README.md

```markdown
# ìŒì„± AI ê±´ê°•ì£¼ì¹˜ì˜ ì•± - Backend

40-60ëŒ€ë¥¼ ìœ„í•œ ê°€ì¡± ì¤‘ì‹¬ ìŒì„± AI ê±´ê°• ê´€ë¦¬ í”Œë«í¼ì˜ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.

## í”„ë¡œì íŠ¸ êµ¬ì¡°

- **Core API Service**: ì¸ì¦, ì‚¬ìš©ì, ê°€ì¡±, ë£¨í‹´, êµ¬ë… ê´€ë¦¬
- **Conversation Service**: OpenAI Realtime API ê¸°ë°˜ ìŒì„± ìƒë‹´

## ê¸°ìˆ  ìŠ¤íƒ

- Python 3.11
- FastAPI
- PostgreSQL 15
- Redis 7
- OpenAI Realtime API
- Chroma DB

## ë¡œì»¬ ì‹¤í–‰

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­
- Docker & Docker Compose
- Python 3.11+

### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
cp .env.example .env
# .env íŒŒì¼ ìˆ˜ì • (OPENAI_API_KEY ë“±)
```

### 2. Docker Compose ì‹¤í–‰
```bash
docker-compose up -d
```

### 3. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
```bash
docker-compose exec core_api alembic upgrade head
```

### 4. ì´ˆê¸° ë°ì´í„° ì‚½ì…
```bash
docker-compose exec core_api python scripts/seed_data.py
```

### 5. API í™•ì¸
- Core API: http://localhost:8000/docs
- Conversation API: http://localhost:8004/docs

## í…ŒìŠ¤íŠ¸

```bash
docker-compose exec core_api pytest
```

## ì°¸ì¡° ë¬¸ì„œ

- PRD v1.2
- TRD v1.2
- AI ìºë¦­í„° í”„ë¡¬í”„íŠ¸ ê°€ì´ë“œ v1.1
- ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸ v1.2

## ë¼ì´ì„¼ìŠ¤

Proprietary
```

## ì™„ë£Œ ê¸°ì¤€
- [ ] ëª¨ë“  í´ë” ë° íŒŒì¼ì´ ìƒì„±ë¨
- [ ] requirements.txtê°€ ì™„ì„±ë¨
- [ ] docker-compose.ymlì´ ì‘ë™í•¨
- [ ] README.mdê°€ ëª…í™•í•¨
- [ ] .gitignoreê°€ ì„¤ì •ë¨

## í…ŒìŠ¤íŠ¸
```bash
cd /home/claude/healthai-backend
docker-compose up -d
docker-compose ps  # 3ê°œ ì»¨í…Œì´ë„ˆ (postgres, redis, core_api) ì‹¤í–‰ í™•ì¸
curl http://localhost:8000/docs  # Swagger UI í™•ì¸
docker-compose logs core_api  # ë¡œê·¸ í™•ì¸
docker-compose down
```

## ì™„ë£Œ ë³´ê³ 
ì™„ë£Œë˜ë©´ ë‹¤ìŒì„ ë³´ê³ í•´ì¤˜:
1. "Day 1-2 ì™„ë£Œ"
2. ìƒì„±ëœ íŒŒì¼ ëª©ë¡ (íŠ¸ë¦¬ êµ¬ì¡°)
3. docker-compose ì‹¤í–‰ ê²°ê³¼
4. ë‹¤ìŒ ë‹¨ê³„ ì¤€ë¹„ì‚¬í•­ (Day 3-4ë¡œ ì§„í–‰ ê°€ëŠ¥ ì—¬ë¶€)
```

---

#### Day 3-4: ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

```markdown
# Day 3-4: ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ ë° ëª¨ë¸ ìƒì„±

## ëª©í‘œ
TRD v1.2ì˜ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ SQLAlchemy ëª¨ë¸ë¡œ êµ¬í˜„í•©ë‹ˆë‹¤.

## ì°¸ì¡°
- ê°œë°œ_ì²´í¬ë¦¬ìŠ¤íŠ¸_v1.2.md: Day 3-4
- TRD v1.2: ì„¹ì…˜ 4 (ì „ì²´ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„)
- TRD v1.2: ì„¹ì…˜ 4.2 (í…Œì´ë¸” ì •ì˜)

## ìš”êµ¬ì‚¬í•­

### 1. core_api/database.py ì‘ì„±

```python
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
from core_api.config import settings

engine = create_engine(
    settings.DATABASE_URL,
    pool_pre_ping=True,
    pool_size=10,
    max_overflow=20
)

SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

Base = declarative_base()

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

### 2. SQLAlchemy ëª¨ë¸ ìƒì„±

#### core_api/models/user.py
TRD 4.2.1 `users` í…Œì´ë¸”ì„ ì •í™•íˆ êµ¬í˜„:

```python
import uuid
from datetime import datetime
from sqlalchemy import Column, String, DateTime, Enum, Date
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
from core_api.database import Base
import enum

class SocialProvider(str, enum.Enum):
    KAKAO = "kakao"
    GOOGLE = "google"
    APPLE = "apple"

class Gender(str, enum.Enum):
    MALE = "male"
    FEMALE = "female"
    OTHER = "other"

class User(Base):
    __tablename__ = "users"
    
    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    social_provider = Column(Enum(SocialProvider), nullable=False)
    social_id = Column(String(255), nullable=False, unique=True)
    email = Column(String(255), unique=True)
    name = Column(String(100), nullable=False)
    profile_image_url = Column(String(500))
    phone_number = Column(String(20))
    birth_date = Column(Date)
    gender = Column(Enum(Gender))
    
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    deleted_at = Column(DateTime)
    
    # Relationships
    family_profiles = relationship("FamilyProfile", back_populates="user", cascade="all, delete-orphan")
    subscriptions = relationship("Subscription", back_populates="user", cascade="all, delete-orphan")
    conversations = relationship("Conversation", back_populates="user", cascade="all, delete-orphan")
    
    def __repr__(self):
        return f"<User {self.name} ({self.email})>"
```

#### core_api/models/family.py
TRD 4.2.2 `family_profiles` í…Œì´ë¸”:

```python
import uuid
from datetime import datetime
from sqlalchemy import Column, String, DateTime, Enum, Date, ForeignKey, Text
from sqlalchemy.dialects.postgresql import UUID, JSONB
from sqlalchemy.orm import relationship
from core_api.database import Base
import enum

class Relationship(str, enum.Enum):
    SELF = "self"
    PARENT = "parent"
    SPOUSE = "spouse"
    CHILD = "child"
    SIBLING = "sibling"
    OTHER = "other"

class FamilyProfile(Base):
    __tablename__ = "family_profiles"
    
    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id", ondelete="CASCADE"), nullable=False)
    
    name = Column(String(100), nullable=False)
    relationship = Column(Enum(Relationship), nullable=False)
    birth_date = Column(Date)
    gender = Column(Enum(Gender))
    profile_image_url = Column(String(500))
    
    # ê±´ê°• ì •ë³´ (JSONB)
    # í˜•ì‹: {"height": 175, "weight": 70, "blood_pressure": "120/80", ...}
    health_info = Column(JSONB)
    
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    deleted_at = Column(DateTime)
    
    # Relationships
    user = relationship("User", back_populates="family_profiles")
    conversations = relationship("Conversation", back_populates="family_profile", cascade="all, delete-orphan")
    health_data = relationship("HealthData", back_populates="family_profile", cascade="all, delete-orphan")
    routine_check_records = relationship("RoutineCheckRecord", back_populates="family_profile", cascade="all, delete-orphan")
    routine_notification = relationship("RoutineNotification", back_populates="family_profile", uselist=False, cascade="all, delete-orphan")
    
    def __repr__(self):
        return f"<FamilyProfile {self.name} ({self.relationship})>"
```

#### core_api/models/conversation.py
TRD 4.2.3, 4.2.4 í…Œì´ë¸”:

```python
import uuid
from datetime import datetime
from sqlalchemy import Column, String, DateTime, Enum, ForeignKey, Integer, Text
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
from core_api.database import Base
import enum

class ConversationStatus(str, enum.Enum):
    ACTIVE = "active"
    COMPLETED = "completed"
    INTERRUPTED = "interrupted"

class MessageRole(str, enum.Enum):
    USER = "user"
    ASSISTANT = "assistant"

class Conversation(Base):
    __tablename__ = "conversations"
    
    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id", ondelete="CASCADE"), nullable=False)
    family_profile_id = Column(UUID(as_uuid=True), ForeignKey("family_profiles.id", ondelete="SET NULL"))
    
    character_id = Column(String(50), nullable=False)
    session_id = Column(String(100), unique=True, nullable=False)
    status = Column(Enum(ConversationStatus), default=ConversationStatus.ACTIVE)
    
    started_at = Column(DateTime, default=datetime.utcnow)
    ended_at = Column(DateTime)
    duration_seconds = Column(Integer)
    
    audio_url = Column(Text)
    
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    
    # Relationships
    user = relationship("User", back_populates="conversations")
    family_profile = relationship("FamilyProfile", back_populates="conversations")
    messages = relationship("ConversationMessage", back_populates="conversation", cascade="all, delete-orphan")
    
    def __repr__(self):
        return f"<Conversation {self.session_id} ({self.status})>"

class ConversationMessage(Base):
    __tablename__ = "conversation_messages"
    
    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    conversation_id = Column(UUID(as_uuid=True), ForeignKey("conversations.id", ondelete="CASCADE"), nullable=False)
    
    role = Column(Enum(MessageRole), nullable=False)
    content = Column(Text, nullable=False)
    audio_url = Column(Text)
    
    created_at = Column(DateTime, default=datetime.utcnow)
    
    # Relationships
    conversation = relationship("Conversation", back_populates="messages")
    
    def __repr__(self):
        return f"<ConversationMessage {self.role}: {self.content[:50]}...>"
```

#### core_api/models/routine.py
TRD 4.2.12, 4.2.13, 4.2.14 í…Œì´ë¸”:

```python
import uuid
from datetime import datetime, time
from sqlalchemy import Column, String, Integer, Boolean, DateTime, Date, Time, ForeignKey, Text, UniqueConstraint
from sqlalchemy.dialects.postgresql import UUID, JSONB
from sqlalchemy.orm import relationship
from core_api.database import Base

class MorningRoutine(Base):
    __tablename__ = "morning_routines"
    
    id = Column(Integer, primary_key=True, autoincrement=True)
    name = Column(String(100), nullable=False)
    icon_emoji = Column(String(10), nullable=False)
    display_order = Column(Integer, nullable=False)
    is_active = Column(Boolean, default=True)
    
    def __repr__(self):
        return f"<MorningRoutine {self.name}>"

class RoutineCheckRecord(Base):
    __tablename__ = "routine_check_records"
    
    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    family_profile_id = Column(UUID(as_uuid=True), ForeignKey("family_profiles.id", ondelete="CASCADE"), nullable=False)
    
    check_date = Column(Date, nullable=False)
    
    # ë£¨í‹´ ì²´í¬ ë°ì´í„° (JSONB)
    # í˜•ì‹: [{"routine_id": 1, "checked": true, "checked_at": "2026-02-12T08:30:00Z"}, ...]
    routine_checks = Column(JSONB, nullable=False, default=list)
    
    # ì»¨ë””ì…˜
    mood = Column(Integer)  # 1-5
    energy_level = Column(Integer)  # 1-5
    
    # ëª©í‘œ ë° ì¼ì •
    goal_of_day = Column(Text)
    
    # ì¼ì • (JSONB)
    # í˜•ì‹: [{"time": "10:00", "description": "íŒ€ íšŒì˜"}, ...]
    schedules = Column(JSONB, default=list)
    
    # ê°ì‚¬ ì¼ê¸° (JSONB)
    # í˜•ì‹: ["í–‡ì‚´ ì¢‹ì€ ë‚ ì”¨", "ê°€ì¡±ì˜ ê±´ê°•", "ë§›ìˆëŠ” ì•„ì¹¨ì‹ì‚¬"]
    gratitude_items = Column(JSONB, default=list)
    
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    
    # Relationships
    family_profile = relationship("FamilyProfile", back_populates="routine_check_records")
    
    __table_args__ = (
        UniqueConstraint('family_profile_id', 'check_date', name='uq_family_profile_check_date'),
    )
    
    def __repr__(self):
        return f"<RoutineCheckRecord {self.check_date}>"

class RoutineNotification(Base):
    __tablename__ = "routine_notifications"
    
    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    family_profile_id = Column(UUID(as_uuid=True), ForeignKey("family_profiles.id", ondelete="CASCADE"), nullable=False, unique=True)
    
    is_enabled = Column(Boolean, default=True)
    notification_time = Column(Time, default=time(8, 0))  # 08:00:00
    
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    
    # Relationships
    family_profile = relationship("FamilyProfile", back_populates="routine_notification")
    
    def __repr__(self):
        return f"<RoutineNotification {self.notification_time}>"
```

#### core_api/models/subscription.py
TRD 4.2.6 í…Œì´ë¸”:

```python
import uuid
from datetime import datetime
from decimal import Decimal
from sqlalchemy import Column, String, DateTime, Enum, ForeignKey, DECIMAL
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
from core_api.database import Base
import enum

class PlanType(str, enum.Enum):
    FREE = "free"
    BASIC = "basic"
    PREMIUM = "premium"
    FAMILY = "family"

class SubscriptionStatus(str, enum.Enum):
    ACTIVE = "active"
    CANCELLED = "cancelled"
    EXPIRED = "expired"
    TRIAL = "trial"

class BillingCycle(str, enum.Enum):
    MONTHLY = "monthly"
    YEARLY = "yearly"

class Subscription(Base):
    __tablename__ = "subscriptions"
    
    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id", ondelete="CASCADE"), nullable=False)
    
    plan_type = Column(Enum(PlanType), nullable=False, default=PlanType.FREE)
    status = Column(Enum(SubscriptionStatus), nullable=False, default=SubscriptionStatus.ACTIVE)
    
    price = Column(DECIMAL(10, 2), default=Decimal('0.00'))
    currency = Column(String(3), default="KRW")
    billing_cycle = Column(Enum(BillingCycle))
    
    started_at = Column(DateTime, default=datetime.utcnow)
    expires_at = Column(DateTime)
    cancelled_at = Column(DateTime)
    
    payment_method = Column(String(50))
    external_subscription_id = Column(String(255))  # RevenueCat ID
    
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    
    # Relationships
    user = relationship("User", back_populates="subscriptions")
    
    def __repr__(self):
        return f"<Subscription {self.plan_type} ({self.status})>"
```

#### core_api/models/__init__.py

```python
from core_api.models.user import User, SocialProvider, Gender
from core_api.models.family import FamilyProfile, Relationship
from core_api.models.conversation import Conversation, ConversationMessage, ConversationStatus, MessageRole
from core_api.models.routine import MorningRoutine, RoutineCheckRecord, RoutineNotification
from core_api.models.subscription import Subscription, PlanType, SubscriptionStatus, BillingCycle

__all__ = [
    "User",
    "SocialProvider",
    "Gender",
    "FamilyProfile",
    "Relationship",
    "Conversation",
    "ConversationMessage",
    "ConversationStatus",
    "MessageRole",
    "MorningRoutine",
    "RoutineCheckRecord",
    "RoutineNotification",
    "Subscription",
    "PlanType",
    "SubscriptionStatus",
    "BillingCycle",
]
```

### 3. Alembic ì„¤ì •

#### alembic/env.py

```python
from logging.config import fileConfig
from sqlalchemy import engine_from_config, pool
from alembic import context
import os
import sys

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¥¼ sys.pathì— ì¶”ê°€
sys.path.insert(0, os.path.dirname(os.path.dirname(__file__)))

from core_api.database import Base
from core_api.models import *  # ëª¨ë“  ëª¨ë¸ import

# Alembic Config ê°ì²´
config = context.config

# í™˜ê²½ ë³€ìˆ˜ì—ì„œ DATABASE_URL ê°€ì ¸ì˜¤ê¸°
database_url = os.getenv("DATABASE_URL", "postgresql://healthai:password@localhost:5432/healthai_db")
config.set_main_option("sqlalchemy.url", database_url)

# Logging ì„¤ì •
if config.config_file_name is not None:
    fileConfig(config.config_file_name)

target_metadata = Base.metadata

def run_migrations_offline() -> None:
    url = config.get_main_option("sqlalchemy.url")
    context.configure(
        url=url,
        target_metadata=target_metadata,
        literal_binds=True,
        dialect_opts={"paramstyle": "named"},
    )

    with context.begin_transaction():
        context.run_migrations()

def run_migrations_online() -> None:
    connectable = engine_from_config(
        config.get_section(config.config_ini_section, {}),
        prefix="sqlalchemy.",
        poolclass=pool.NullPool,
    )

    with connectable.connect() as connection:
        context.configure(
            connection=connection,
            target_metadata=target_metadata
        )

        with context.begin_transaction():
            context.run_migrations()

if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()
```

### 4. ì´ˆê¸° ë°ì´í„° ì‚½ì… ìŠ¤í¬ë¦½íŠ¸

#### scripts/seed_data.py

```python
#!/usr/bin/env python3
"""
ì´ˆê¸° ë°ì´í„° ì‚½ì… ìŠ¤í¬ë¦½íŠ¸
- 8ê°œ ì•„ì¹¨ ë£¨í‹´ í•­ëª© ì‚½ì…
"""
import sys
import os

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¥¼ sys.pathì— ì¶”ê°€
sys.path.insert(0, os.path.dirname(os.path.dirname(__file__)))

from core_api.database import SessionLocal, engine
from core_api.models import MorningRoutine, Base

def seed_morning_routines():
    """TRD 4.3.12ì˜ 8ê°œ ë£¨í‹´ í•­ëª© ì‚½ì…"""
    db = SessionLocal()
    
    try:
        # ê¸°ì¡´ ë°ì´í„° í™•ì¸
        existing_count = db.query(MorningRoutine).count()
        if existing_count > 0:
            print(f"âš ï¸  ì•„ì¹¨ ë£¨í‹´ ë°ì´í„°ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤ ({existing_count}ê°œ)")
            return
        
        routines = [
            {"name": "ì´ë¶ˆ ì •ë¦¬", "icon_emoji": "ğŸ›ï¸", "display_order": 1},
            {"name": "ê³µë³µì— ë¬¼ ë§ˆì‹œê¸°", "icon_emoji": "ğŸ’§", "display_order": 2},
            {"name": "ëª…ìƒ, ë…ì„œ", "icon_emoji": "ğŸ§˜", "display_order": 3},
            {"name": "í•œ ë™ì‘ ìš´ë™", "icon_emoji": "ğŸƒ", "display_order": 4},
            {"name": "ì°¨ ë§ˆì‹œê¸°", "icon_emoji": "â˜•", "display_order": 5},
            {"name": "ì˜ì–‘ì œ ë¨¹ê¸°", "icon_emoji": "ğŸ’Š", "display_order": 6},
            {"name": "ëª¨ë‹ ëŸ¬ë‹", "icon_emoji": "ğŸƒâ€â™‚ï¸", "display_order": 7},
            {"name": "ì˜¤ëŠ˜ í•  ì¼ ì •ë¦¬", "icon_emoji": "ğŸ“", "display_order": 8},
        ]
        
        for routine_data in routines:
            routine = MorningRoutine(**routine_data)
            db.add(routine)
        
        db.commit()
        print(f"âœ… ì•„ì¹¨ ë£¨í‹´ {len(routines)}ê°œ í•­ëª© ì‚½ì… ì™„ë£Œ!")
        
        # í™•ì¸
        all_routines = db.query(MorningRoutine).order_by(MorningRoutine.display_order).all()
        for r in all_routines:
            print(f"   {r.id}. {r.icon_emoji} {r.name}")
    
    except Exception as e:
        print(f"âŒ ì˜¤ë¥˜ ë°œìƒ: {e}")
        db.rollback()
    finally:
        db.close()

if __name__ == "__main__":
    print("ğŸŒ± ì´ˆê¸° ë°ì´í„° ì‚½ì… ì‹œì‘...")
    seed_morning_routines()
    print("âœ¨ ì™„ë£Œ!")
```

## ì™„ë£Œ ê¸°ì¤€
- [ ] ëª¨ë“  ëª¨ë¸ì´ TRD ìŠ¤í™ê³¼ 100% ì¼ì¹˜
- [ ] ì™¸ë˜í‚¤ ê´€ê³„ê°€ ERDì™€ ì¼ì¹˜
- [ ] Enum íƒ€ì…ì´ ì •í™•íˆ ì •ì˜ë¨
- [ ] Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ì„±ê³µ
- [ ] ì´ˆê¸° ë°ì´í„° ì‚½ì… ì„±ê³µ

## í…ŒìŠ¤íŠ¸

```bash
# Docker Compose ì‹¤í–‰
docker-compose up -d

# Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
docker-compose exec core_api alembic revision --autogenerate -m "Initial schema"

# ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
docker-compose exec core_api alembic upgrade head

# ì´ˆê¸° ë°ì´í„° ì‚½ì…
docker-compose exec core_api python scripts/seed_data.py

# PostgreSQL ì ‘ì† í™•ì¸
docker-compose exec postgres psql -U healthai -d healthai_db

# SQL ëª…ë ¹ì–´ë¡œ í™•ì¸
\dt  # í…Œì´ë¸” ëª©ë¡
\d users  # users í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ
\d family_profiles  # family_profiles í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ
SELECT * FROM morning_routines;  # ë£¨í‹´ ë°ì´í„° í™•ì¸

# ë¹ ì ¸ë‚˜ì˜¤ê¸°
\q
```

## ì™„ë£Œ ë³´ê³ 
ì™„ë£Œë˜ë©´ ë‹¤ìŒì„ ë³´ê³ í•´ì¤˜:
1. "Day 3-4 ì™„ë£Œ"
2. ìƒì„±ëœ í…Œì´ë¸” ëª©ë¡ (9ê°œ í…Œì´ë¸”)
3. morning_routines ë°ì´í„° í™•ì¸ ê²°ê³¼ (8ê°œ í•­ëª©)
4. ERD ê´€ê³„ ìš”ì•½
5. ë‹¤ìŒ ë‹¨ê³„ ì¤€ë¹„ì‚¬í•­ (Day 5-8ë¡œ ì§„í–‰ ê°€ëŠ¥ ì—¬ë¶€)
```

---

#### Day 5-8: ì¸ì¦ ì‹œìŠ¤í…œ

```markdown
# Day 5-8: JWT ê¸°ë°˜ ì†Œì…œ ë¡œê·¸ì¸ ì¸ì¦ ì‹œìŠ¤í…œ

## ëª©í‘œ
ì¹´ì¹´ì˜¤, êµ¬ê¸€, ì• í”Œ ì†Œì…œ ë¡œê·¸ì¸ê³¼ JWT í† í° ê´€ë¦¬ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

## ì°¸ì¡°
- ê°œë°œ_ì²´í¬ë¦¬ìŠ¤íŠ¸_v1.2.md: Day 5-8
- TRD v1.2: ì„¹ì…˜ 5.1 (Auth Service API)
- TRD v1.2: ì„¹ì…˜ 9.1 (ì¸ì¦ ë° ì¸ê°€)

## ìš”êµ¬ì‚¬í•­

### 1. core_api/config.py ì„¤ì •

```python
from pydantic_settings import BaseSettings
from functools import lru_cache

class Settings(BaseSettings):
    # App
    APP_NAME: str = "HealthAI API"
    APP_VERSION: str = "1.0.0"
    ENVIRONMENT: str = "development"
    LOG_LEVEL: str = "info"
    
    # Database
    DATABASE_URL: str
    
    # Redis
    REDIS_URL: str
    
    # JWT
    JWT_SECRET_KEY: str
    JWT_ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30
    REFRESH_TOKEN_EXPIRE_DAYS: int = 14
    
    # OAuth - Kakao
    KAKAO_CLIENT_ID: str = ""
    KAKAO_CLIENT_SECRET: str = ""
    KAKAO_REDIRECT_URI: str = ""
    
    # OAuth - Google
    GOOGLE_CLIENT_ID: str = ""
    GOOGLE_CLIENT_SECRET: str = ""
    GOOGLE_REDIRECT_URI: str = ""
    
    # OAuth - Apple
    APPLE_CLIENT_ID: str = ""
    APPLE_TEAM_ID: str = ""
    APPLE_KEY_ID: str = ""
    APPLE_PRIVATE_KEY_PATH: str = ""
    
    # OpenAI
    OPENAI_API_KEY: str = ""
    
    class Config:
        env_file = ".env"
        case_sensitive = True

@lru_cache()
def get_settings() -> Settings:
    return Settings()

settings = get_settings()
```

### 2. core_api/schemas/auth.py

```python
from pydantic import BaseModel, EmailStr
from typing import Optional
from datetime import datetime
from core_api.models.user import SocialProvider, Gender

class SocialLoginRequest(BaseModel):
    provider: SocialProvider
    access_token: str  # ì†Œì…œ ë¡œê·¸ì¸ì—ì„œ ë°›ì€ í† í°
    
class TokenResponse(BaseModel):
    access_token: str
    refresh_token: str
    token_type: str = "bearer"
    expires_in: int  # seconds
    user_id: str
    is_new_user: bool  # ì‹ ê·œ ê°€ì… ì—¬ë¶€
    
class RefreshTokenRequest(BaseModel):
    refresh_token: str
    
class UserInfoResponse(BaseModel):
    id: str
    email: Optional[EmailStr]
    name: str
    profile_image_url: Optional[str]
    social_provider: SocialProvider
    created_at: datetime
    
    class Config:
        from_attributes = True
```

### 3. core_api/services/auth_service.py

```python
from datetime import datetime, timedelta
from typing import Optional, Dict, Any
from jose import JWTError, jwt
from sqlalchemy.orm import Session
import httpx

from core_api.config import settings
from core_api.models.user import User, SocialProvider
from core_api.schemas.auth import TokenResponse, UserInfoResponse

class AuthService:
    
    def __init__(self, db: Session):
        self.db = db
    
    def create_access_token(self, data: dict) -> str:
        """Access Token ìƒì„± (30ë¶„)"""
        to_encode = data.copy()
        expire = datetime.utcnow() + timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
        to_encode.update({"exp": expire, "type": "access"})
        return jwt.encode(to_encode, settings.JWT_SECRET_KEY, algorithm=settings.JWT_ALGORITHM)
    
    def create_refresh_token(self, data: dict) -> str:
        """Refresh Token ìƒì„± (14ì¼)"""
        to_encode = data.copy()
        expire = datetime.utcnow() + timedelta(days=settings.REFRESH_TOKEN_EXPIRE_DAYS)
        to_encode.update({"exp": expire, "type": "refresh"})
        return jwt.encode(to_encode, settings.JWT_SECRET_KEY, algorithm=settings.JWT_ALGORITHM)
    
    def verify_token(self, token: str, token_type: str = "access") -> Optional[Dict[str, Any]]:
        """í† í° ê²€ì¦"""
        try:
            payload = jwt.decode(token, settings.JWT_SECRET_KEY, algorithms=[settings.JWT_ALGORITHM])
            if payload.get("type") != token_type:
                return None
            return payload
        except JWTError:
            return None
    
    async def verify_kakao_token(self, access_token: str) -> Optional[Dict[str, Any]]:
        """ì¹´ì¹´ì˜¤ í† í° ê²€ì¦ ë° ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°"""
        async with httpx.AsyncClient() as client:
            try:
                response = await client.get(
                    "https://kapi.kakao.com/v2/user/me",
                    headers={"Authorization": f"Bearer {access_token}"}
                )
                
                if response.status_code != 200:
                    return None
                
                data = response.json()
                kakao_account = data.get("kakao_account", {})
                profile = kakao_account.get("profile", {})
                
                return {
                    "social_id": str(data.get("id")),
                    "email": kakao_account.get("email"),
                    "name": profile.get("nickname", "ì‚¬ìš©ì"),
                    "profile_image_url": profile.get("profile_image_url"),
                }
            except Exception as e:
                print(f"Kakao token verification error: {e}")
                return None
    
    async def verify_google_token(self, access_token: str) -> Optional[Dict[str, Any]]:
        """êµ¬ê¸€ í† í° ê²€ì¦ ë° ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°"""
        async with httpx.AsyncClient() as client:
            try:
                response = await client.get(
                    "https://www.googleapis.com/oauth2/v2/userinfo",
                    headers={"Authorization": f"Bearer {access_token}"}
                )
                
                if response.status_code != 200:
                    return None
                
                data = response.json()
                return {
                    "social_id": data.get("id"),
                    "email": data.get("email"),
                    "name": data.get("name", "ì‚¬ìš©ì"),
                    "profile_image_url": data.get("picture"),
                }
            except Exception as e:
                print(f"Google token verification error: {e}")
                return None
    
    async def verify_apple_token(self, id_token: str) -> Optional[Dict[str, Any]]:
        """ì• í”Œ ID í† í° ê²€ì¦ ë° ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°"""
        # Apple Sign Inì€ ID Tokenì„ ì§ì ‘ íŒŒì‹±
        # ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” Appleì˜ public keyë¡œ ì„œëª… ê²€ì¦ í•„ìš”
        try:
            # ê°„ë‹¨í•œ êµ¬í˜„ (ì‹¤ì œë¡œëŠ” ì„œëª… ê²€ì¦ í•„ìˆ˜)
            payload = jwt.decode(id_token, options={"verify_signature": False})
            
            return {
                "social_id": payload.get("sub"),
                "email": payload.get("email"),
                "name": "Apple ì‚¬ìš©ì",  # Appleì€ ì´ë¦„ì„ ì œê³µí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
                "profile_image_url": None,
            }
        except Exception as e:
            print(f"Apple token verification error: {e}")
            return None
    
    async def social_login(self, provider: SocialProvider, access_token: str) -> TokenResponse:
        """ì†Œì…œ ë¡œê·¸ì¸ ì²˜ë¦¬"""
        
        # 1. ì†Œì…œ í”Œë«í¼ì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        if provider == SocialProvider.KAKAO:
            user_info = await self.verify_kakao_token(access_token)
        elif provider == SocialProvider.GOOGLE:
            user_info = await self.verify_google_token(access_token)
        elif provider == SocialProvider.APPLE:
            user_info = await self.verify_apple_token(access_token)
        else:
            raise ValueError(f"Unsupported provider: {provider}")
        
        if not user_info:
            raise ValueError("Invalid access token")
        
        # 2. ê¸°ì¡´ ì‚¬ìš©ì í™•ì¸ ë˜ëŠ” ì‹ ê·œ ìƒì„±
        user = self.db.query(User).filter(
            User.social_provider == provider,
            User.social_id == user_info["social_id"]
        ).first()
        
        is_new_user = False
        
        if not user:
            # ì‹ ê·œ ì‚¬ìš©ì ìƒì„±
            user = User(
                social_provider=provider,
                social_id=user_info["social_id"],
                email=user_info.get("email"),
                name=user_info["name"],
                profile_image_url=user_info.get("profile_image_url")
            )
            self.db.add(user)
            self.db.commit()
            self.db.refresh(user)
            is_new_user = True
        else:
            # ê¸°ì¡´ ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸ (í”„ë¡œí•„ ì´ë¯¸ì§€ ë“±)
            user.profile_image_url = user_info.get("profile_image_url")
            user.updated_at = datetime.utcnow()
            self.db.commit()
        
        # 3. JWT í† í° ìƒì„±
        token_data = {"sub": str(user.id), "email": user.email}
        access_token_jwt = self.create_access_token(token_data)
        refresh_token_jwt = self.create_refresh_token(token_data)
        
        return TokenResponse(
            access_token=access_token_jwt,
            refresh_token=refresh_token_jwt,
            expires_in=settings.ACCESS_TOKEN_EXPIRE_MINUTES * 60,
            user_id=str(user.id),
            is_new_user=is_new_user
        )
    
    def refresh_access_token(self, refresh_token: str) -> TokenResponse:
        """Refresh Tokenìœ¼ë¡œ Access Token ê°±ì‹ """
        payload = self.verify_token(refresh_token, token_type="refresh")
        if not payload:
            raise ValueError("Invalid refresh token")
        
        user_id = payload.get("sub")
        user = self.db.query(User).filter(User.id == user_id).first()
        
        if not user:
            raise ValueError("User not found")
        
        # ìƒˆë¡œìš´ Access Token ìƒì„±
        token_data = {"sub": str(user.id), "email": user.email}
        access_token = self.create_access_token(token_data)
        
        return TokenResponse(
            access_token=access_token,
            refresh_token=refresh_token,  # Refresh Tokenì€ ì¬ì‚¬ìš©
            expires_in=settings.ACCESS_TOKEN_EXPIRE_MINUTES * 60,
            user_id=str(user.id),
            is_new_user=False
        )
```

### 4. core_api/dependencies.py

```python
from fastapi import Depends, HTTPException, status
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from sqlalchemy.orm import Session
from core_api.database import get_db
from core_api.services.auth_service import AuthService
from core_api.models.user import User

security = HTTPBearer()

def get_current_user(
    credentials: HTTPAuthorizationCredentials = Depends(security),
    db: Session = Depends(get_db)
) -> User:
    """í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ë°˜í™˜"""
    token = credentials.credentials
    
    auth_service = AuthService(db)
    payload = auth_service.verify_token(token, token_type="access")
    
    if not payload:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Invalid or expired token",
            headers={"WWW-Authenticate": "Bearer"},
        )
    
    user_id = payload.get("sub")
    user = db.query(User).filter(User.id == user_id).first()
    
    if not user:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="User not found"
        )
    
    return user
```

### 5. core_api/routers/auth.py

```python
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session

from core_api.database import get_db
from core_api.schemas.auth import SocialLoginRequest, TokenResponse, RefreshTokenRequest, UserInfoResponse
from core_api.services.auth_service import AuthService
from core_api.dependencies import get_current_user
from core_api.models.user import User

router = APIRouter(prefix="/api/v1/auth", tags=["Authentication"])

@router.post("/login/social", response_model=TokenResponse, status_code=status.HTTP_200_OK)
async def social_login(
    request: SocialLoginRequest,
    db: Session = Depends(get_db)
):
    """
    ì†Œì…œ ë¡œê·¸ì¸ (ì¹´ì¹´ì˜¤, êµ¬ê¸€, ì• í”Œ)
    
    - **provider**: ì†Œì…œ ë¡œê·¸ì¸ ì œê³µì (kakao, google, apple)
    - **access_token**: ì†Œì…œ í”Œë«í¼ì—ì„œ ë°›ì€ access token
    
    ë°˜í™˜:
    - JWT access_token (30ë¶„)
    - JWT refresh_token (14ì¼)
    - is_new_user: ì‹ ê·œ ê°€ì… ì—¬ë¶€
    """
    auth_service = AuthService(db)
    
    try:
        token_response = await auth_service.social_login(
            provider=request.provider,
            access_token=request.access_token
        )
        return token_response
    except ValueError as e:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail=str(e)
        )

@router.post("/refresh", response_model=TokenResponse)
def refresh_token(
    request: RefreshTokenRequest,
    db: Session = Depends(get_db)
):
    """
    Refresh Tokenìœ¼ë¡œ Access Token ê°±ì‹ 
    
    - **refresh_token**: JWT refresh token
    
    ë°˜í™˜:
    - ìƒˆë¡œìš´ access_token
    - ê¸°ì¡´ refresh_token (ì¬ì‚¬ìš©)
    """
    auth_service = AuthService(db)
    
    try:
        token_response = auth_service.refresh_access_token(request.refresh_token)
        return token_response
    except ValueError as e:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail=str(e)
        )

@router.post("/logout", status_code=status.HTTP_204_NO_CONTENT)
def logout(current_user: User = Depends(get_current_user)):
    """
    ë¡œê·¸ì•„ì›ƒ
    
    ì‹¤ì œë¡œëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ í† í°ì„ ì‚­ì œí•˜ë©´ ë¨.
    ì„œë²„ ì¸¡ì—ì„œëŠ” í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ë¥¼ ê´€ë¦¬í•  ìˆ˜ë„ ìˆìŒ (í–¥í›„ êµ¬í˜„).
    """
    # í–¥í›„: Redisì— í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì¶”ê°€
    return

@router.get("/me", response_model=UserInfoResponse)
def get_current_user_info(current_user: User = Depends(get_current_user)):
    """
    í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
    """
    return current_user
```

### 6. core_api/main.py ì—…ë°ì´íŠ¸

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from core_api.routers import auth
from core_api.config import settings

app = FastAPI(
    title=settings.APP_NAME,
    version=settings.APP_VERSION,
    description="ìŒì„± AI ê±´ê°•ì£¼ì¹˜ì˜ ì•± - Core API"
)

# CORS ì„¤ì •
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # í”„ë¡œë•ì…˜ì—ì„œëŠ” ì œí•œ í•„ìš”
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Routers
app.include_router(auth.router)

@app.get("/health")
def health_check():
    return {"status": "healthy", "service": "core-api"}

@app.get("/")
def root():
    return {
        "message": "Welcome to HealthAI API",
        "version": settings.APP_VERSION,
        "docs": "/docs"
    }
```

### 7. tests/test_auth.py

```python
import pytest
from fastapi.testclient import TestClient
from unittest.mock import patch, AsyncMock
from core_api.main import app
from core_api.models.user import SocialProvider

client = TestClient(app)

@pytest.mark.asyncio
async def test_social_login_kakao_success():
    """ì¹´ì¹´ì˜¤ ì†Œì…œ ë¡œê·¸ì¸ ì„±ê³µ í…ŒìŠ¤íŠ¸"""
    
    mock_user_info = {
        "social_id": "123456789",
        "email": "test@kakao.com",
        "name": "í…ŒìŠ¤í„°",
        "profile_image_url": "https://example.com/profile.jpg"
    }
    
    with patch("core_api.services.auth_service.AuthService.verify_kakao_token", new_callable=AsyncMock) as mock_verify:
        mock_verify.return_value = mock_user_info
        
        response = client.post(
            "/api/v1/auth/login/social",
            json={
                "provider": "kakao",
                "access_token": "fake_kakao_token"
            }
        )
        
        assert response.status_code == 200
        data = response.json()
        
        assert "access_token" in data
        assert "refresh_token" in data
        assert data["token_type"] == "bearer"
        assert data["is_new_user"] is True

@pytest.mark.asyncio
async def test_social_login_invalid_token():
    """ì˜ëª»ëœ í† í°ìœ¼ë¡œ ì†Œì…œ ë¡œê·¸ì¸ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸"""
    
    with patch("core_api.services.auth_service.AuthService.verify_kakao_token", new_callable=AsyncMock) as mock_verify:
        mock_verify.return_value = None
        
        response = client.post(
            "/api/v1/auth/login/social",
            json={
                "provider": "kakao",
                "access_token": "invalid_token"
            }
        )
        
        assert response.status_code == 401

def test_refresh_token_success():
    """Refresh Tokenìœ¼ë¡œ Access Token ê°±ì‹  ì„±ê³µ"""
    
    # ë¨¼ì € ë¡œê·¸ì¸í•˜ì—¬ í† í° ë°›ê¸° (mock í•„ìš”)
    # ê·¸ ë‹¤ìŒ refresh í…ŒìŠ¤íŠ¸
    # ì‹¤ì œ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” fixture ì‚¬ìš©
    
    pass

def test_get_current_user_with_valid_token():
    """ìœ íš¨í•œ í† í°ìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ"""
    
    # ë¨¼ì € ë¡œê·¸ì¸í•˜ì—¬ í† í° ë°›ê¸°
    # ê·¸ í† í°ìœ¼ë¡œ /me í˜¸ì¶œ
    
    pass
```

## ì™„ë£Œ ê¸°ì¤€
- [ ] ì¹´ì¹´ì˜¤, êµ¬ê¸€, ì• í”Œ ì†Œì…œ ë¡œê·¸ì¸ êµ¬í˜„ ì™„ë£Œ
- [ ] JWT í† í° ìƒì„±/ê²€ì¦ ë¡œì§ ì‘ë™
- [ ] Refresh Tokenìœ¼ë¡œ Access Token ê°±ì‹  ì‘ë™
- [ ] í† í° ë§Œë£Œ ì‹œ 401 ì—ëŸ¬ ë°˜í™˜
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± ì™„ë£Œ

## í…ŒìŠ¤íŠ¸

```bash
# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
docker-compose exec core_api pytest tests/test_auth.py -v

# ìˆ˜ë™ í…ŒìŠ¤íŠ¸ (Swagger UI)
# http://localhost:8000/docs ì ‘ì†
# POST /api/v1/auth/login/social í…ŒìŠ¤íŠ¸

# ì¹´ì¹´ì˜¤ í† í°ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ (ì‹¤ì œ ì¹´ì¹´ì˜¤ Developer Consoleì—ì„œ í† í° ë°›ì•„ì•¼ í•¨)
curl -X POST "http://localhost:8000/api/v1/auth/login/social" \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "kakao",
    "access_token": "ì‹¤ì œ_ì¹´ì¹´ì˜¤_í† í°"
  }'
```

## ì™„ë£Œ ë³´ê³ 
ì™„ë£Œë˜ë©´ ë‹¤ìŒì„ ë³´ê³ í•´ì¤˜:
1. "Day 5-8 ì™„ë£Œ"
2. êµ¬í˜„ëœ API ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡ (3ê°œ)
3. í…ŒìŠ¤íŠ¸ ê²°ê³¼
4. ë‹¤ìŒ ë‹¨ê³„ ì¤€ë¹„ì‚¬í•­ (Day 9-12ë¡œ ì§„í–‰ ê°€ëŠ¥ ì—¬ë¶€)
```

---

### ğŸ”¹ Week 2: ì‚¬ìš©ì & ê°€ì¡± ê´€ë¦¬ (Day 9-16)

#### Day 9-12: ì‚¬ìš©ì í”„ë¡œí•„ API

```markdown
# Day 9-12: ì‚¬ìš©ì í”„ë¡œí•„ ê´€ë¦¬ API

## ëª©í‘œ
ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ/ìˆ˜ì • ë° ê±´ê°• ì •ë³´ ê´€ë¦¬ APIë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

## ì°¸ì¡°
- ê°œë°œ_ì²´í¬ë¦¬ìŠ¤íŠ¸_v1.2.md: Day 9-12
- TRD v1.2: ì„¹ì…˜ 5.2 (User Service API)
- TRD v1.2: ì„¹ì…˜ 4.2.5 (health_data í…Œì´ë¸”)

## ìš”êµ¬ì‚¬í•­

### 1. core_api/schemas/user.py

```python
from pydantic import BaseModel, EmailStr
from typing import Optional
from datetime import date, datetime
from core_api.models.user import Gender

class UserProfileResponse(BaseModel):
    id: str
    email: Optional[EmailStr]
    name: str
    profile_image_url: Optional[str]
    phone_number: Optional[str]
    birth_date: Optional[date]
    gender: Optional[Gender]
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True

class UpdateUserProfileRequest(BaseModel):
    name: Optional[str] = None
    phone_number: Optional[str] = None
    birth_date: Optional[date] = None
    gender: Optional[Gender] = None

class HealthInfoRequest(BaseModel):
    height: Optional[float] = None  # cm
    weight: Optional[float] = None  # kg
    blood_pressure_systolic: Optional[int] = None  # ìˆ˜ì¶•ê¸°
    blood_pressure_diastolic: Optional[int] = None  # ì´ì™„ê¸°
    blood_sugar: Optional[float] = None  # mg/dL
    chronic_diseases: Optional[list[str]] = None  # ["ê³ í˜ˆì••", "ë‹¹ë‡¨"]
    medications: Optional[list[str]] = None  # ["ë©”íŠ¸í¬ë¥´ë¯¼", "ì•„ìŠ¤í”¼ë¦°"]
    allergies: Optional[list[str]] = None  # ["í˜ë‹ˆì‹¤ë¦°", "ë•…ì½©"]

class HealthInfoResponse(BaseModel):
    height: Optional[float]
    weight: Optional[float]
    bmi: Optional[float]  # ê³„ì‚° ê°’
    blood_pressure: Optional[str]  # "120/80"
    blood_sugar: Optional[float]
    chronic_diseases: list[str]
    medications: list[str]
    allergies: list[str]
```

### 2. core_api/services/user_service.py

```python
from sqlalchemy.orm import Session
from typing import Optional
from core_api.models.user import User
from core_api.models.family import FamilyProfile, Relationship
from core_api.schemas.user import (
    UpdateUserProfileRequest,
    HealthInfoRequest,
    HealthInfoResponse
)
from datetime import datetime

class UserService:
    
    def __init__(self, db: Session):
        self.db = db
    
    def get_user_profile(self, user_id: str) -> User:
        """ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ"""
        user = self.db.query(User).filter(User.id == user_id).first()
        if not user:
            raise ValueError("User not found")
        return user
    
    def update_user_profile(self, user_id: str, data: UpdateUserProfileRequest) -> User:
        """ì‚¬ìš©ì í”„ë¡œí•„ ìˆ˜ì •"""
        user = self.get_user_profile(user_id)
        
        update_data = data.model_dump(exclude_unset=True)
        for key, value in update_data.items():
            setattr(user, key, value)
        
        user.updated_at = datetime.utcnow()
        self.db.commit()
        self.db.refresh(user)
        
        return user
    
    def get_or_create_self_profile(self, user: User) -> FamilyProfile:
        """ì‚¬ìš©ìì˜ ë³¸ì¸(self) í”„ë¡œí•„ ê°€ì ¸ì˜¤ê¸° ë˜ëŠ” ìƒì„±"""
        self_profile = self.db.query(FamilyProfile).filter(
            FamilyProfile.user_id == user.id,
            FamilyProfile.relationship == Relationship.SELF
        ).first()
        
        if not self_profile:
            # ë³¸ì¸ í”„ë¡œí•„ ìë™ ìƒì„±
            self_profile = FamilyProfile(
                user_id=user.id,
                name=user.name,
                relationship=Relationship.SELF,
                birth_date=user.birth_date,
                gender=user.gender,
                profile_image_url=user.profile_image_url,
                health_info={}
            )
            self.db.add(self_profile)
            self.db.commit()
            self.db.refresh(self_profile)
        
        return self_profile
    
    def update_health_info(self, user_id: str, data: HealthInfoRequest) -> HealthInfoResponse:
        """ê±´ê°• ì •ë³´ ë“±ë¡/ìˆ˜ì •"""
        user = self.get_user_profile(user_id)
        self_profile = self.get_or_create_self_profile(user)
        
        # ê¸°ì¡´ health_infoì— ë³‘í•©
        health_info = self_profile.health_info or {}
        
        if data.height is not None:
            health_info["height"] = data.height
        if data.weight is not None:
            health_info["weight"] = data.weight
        if data.blood_pressure_systolic is not None and data.blood_pressure_diastolic is not None:
            health_info["blood_pressure"] = f"{data.blood_pressure_systolic}/{data.blood_pressure_diastolic}"
        if data.blood_sugar is not None:
            health_info["blood_sugar"] = data.blood_sugar
        if data.chronic_diseases is not None:
            health_info["chronic_diseases"] = data.chronic_diseases
        if data.medications is not None:
            health_info["medications"] = data.medications
        if data.allergies is not None:
            health_info["allergies"] = data.allergies
        
        self_profile.health_info = health_info
        self_profile.updated_at = datetime.utcnow()
        self.db.commit()
        self.db.refresh(self_profile)
        
        return self._build_health_info_response(health_info)
    
    def get_health_info(self, user_id: str) -> HealthInfoResponse:
        """ê±´ê°• ì •ë³´ ì¡°íšŒ"""
        user = self.get_user_profile(user_id)
        self_profile = self.get_or_create_self_profile(user)
        
        health_info = self_profile.health_info or {}
        return self._build_health_info_response(health_info)
    
    def _build_health_info_response(self, health_info: dict) -> HealthInfoResponse:
        """health_info dictë¥¼ Response ëª¨ë¸ë¡œ ë³€í™˜"""
        height = health_info.get("height")
        weight = health_info.get("weight")
        
        # BMI ê³„ì‚°
        bmi = None
        if height and weight:
            height_m = height / 100
            bmi = round(weight / (height_m ** 2), 1)
        
        return HealthInfoResponse(
            height=height,
            weight=weight,
            bmi=bmi,
            blood_pressure=health_info.get("blood_pressure"),
            blood_sugar=health_info.get("blood_sugar"),
            chronic_diseases=health_info.get("chronic_diseases", []),
            medications=health_info.get("medications", []),
            allergies=health_info.get("allergies", [])
        )
```

### 3. core_api/routers/users.py

```python
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session

from core_api.database import get_db
from core_api.dependencies import get_current_user
from core_api.models.user import User
from core_api.schemas.user import (
    UserProfileResponse,
    UpdateUserProfileRequest,
    HealthInfoRequest,
    HealthInfoResponse
)
from core_api.services.user_service import UserService

router = APIRouter(prefix="/api/v1/users", tags=["Users"])

@router.get("/me", response_model=UserProfileResponse)
def get_my_profile(
    current_user: User = Depends(get_current_user)
):
    """
    ë‚´ í”„ë¡œí•„ ì¡°íšŒ
    
    ì¸ì¦ëœ ì‚¬ìš©ì ë³¸ì¸ì˜ í”„ë¡œí•„ ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    """
    return current_user

@router.put("/me", response_model=UserProfileResponse)
def update_my_profile(
    data: UpdateUserProfileRequest,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """
    ë‚´ í”„ë¡œí•„ ìˆ˜ì •
    
    - **name**: ì´ë¦„ (ì„ íƒ)
    - **phone_number**: ì „í™”ë²ˆí˜¸ (ì„ íƒ)
    - **birth_date**: ìƒë…„ì›”ì¼ (ì„ íƒ, YYYY-MM-DD)
    - **gender**: ì„±ë³„ (ì„ íƒ, male/female/other)
    """
    user_service = UserService(db)
    
    try:
        updated_user = user_service.update_user_profile(str(current_user.id), data)
        return updated_user
    except ValueError as e:
        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail=str(e))

@router.post("/health-info", response_model=HealthInfoResponse)
def register_health_info(
    data: HealthInfoRequest,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """
    ê±´ê°• ì •ë³´ ë“±ë¡/ìˆ˜ì •
    
    - **height**: ì‹ ì¥ (cm)
    - **weight**: ì²´ì¤‘ (kg)
    - **blood_pressure_systolic**: ìˆ˜ì¶•ê¸° í˜ˆì••
    - **blood_pressure_diastolic**: ì´ì™„ê¸° í˜ˆì••
    - **blood_sugar**: í˜ˆë‹¹ (mg/dL)
    - **chronic_diseases**: ë§Œì„±ì§ˆí™˜ ëª©ë¡
    - **medications**: ë³µìš©ì•½ë¬¼ ëª©ë¡
    - **allergies**: ì•Œë ˆë¥´ê¸° ëª©ë¡
    
    ë°˜í™˜: BMI ìë™ ê³„ì‚° í¬í•¨
    """
    user_service = UserService(db)
    
    try:
        health_info = user_service.update_health_info(str(current_user.id), data)
        return health_info
    except ValueError as e:
        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail=str(e))

@router.get("/health-info", response_model=HealthInfoResponse)
def get_my_health_info(
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """
    ê±´ê°• ì •ë³´ ì¡°íšŒ
    
    ë³¸ì¸ì˜ ê±´ê°• ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
    """
    user_service = UserService(db)
    
    try:
        health_info = user_service.get_health_info(str(current_user.id))
        return health_info
    except ValueError as e:
        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail=str(e))
```

### 4. core_api/main.py ì—…ë°ì´íŠ¸

```python
from core_api.routers import auth, users

# ...

app.include_router(auth.router)
app.include_router(users.router)  # ì¶”ê°€
```

### 5. tests/test_users.py

```python
import pytest
from fastapi.testclient import TestClient
from core_api.main import app

client = TestClient(app)

def test_get_my_profile_without_auth():
    """ì¸ì¦ ì—†ì´ í”„ë¡œí•„ ì¡°íšŒ ì‹œ 401 ì—ëŸ¬"""
    response = client.get("/api/v1/users/me")
    assert response.status_code == 401

def test_get_my_profile_with_auth(auth_token):
    """ì¸ì¦ í›„ í”„ë¡œí•„ ì¡°íšŒ ì„±ê³µ"""
    response = client.get(
        "/api/v1/users/me",
        headers={"Authorization": f"Bearer {auth_token}"}
    )
    assert response.status_code == 200
    data = response.json()
    assert "id" in data
    assert "email" in data

def test_update_profile(auth_token):
    """í”„ë¡œí•„ ìˆ˜ì •"""
    response = client.put(
        "/api/v1/users/me",
        headers={"Authorization": f"Bearer {auth_token}"},
        json={
            "name": "í™ê¸¸ë™",
            "phone_number": "010-1234-5678",
            "birth_date": "1980-01-01",
            "gender": "male"
        }
    )
    assert response.status_code == 200
    data = response.json()
    assert data["name"] == "í™ê¸¸ë™"

def test_register_health_info(auth_token):
    """ê±´ê°• ì •ë³´ ë“±ë¡"""
    response = client.post(
        "/api/v1/users/health-info",
        headers={"Authorization": f"Bearer {auth_token}"},
        json={
            "height": 175.0,
            "weight": 70.0,
            "blood_pressure_systolic": 120,
            "blood_pressure_diastolic": 80,
            "chronic_diseases": ["ì—†ìŒ"],
            "medications": [],
            "allergies": []
        }
    )
    assert response.status_code == 200
    data = response.json()
    assert data["height"] == 175.0
    assert data["bmi"] == 22.9  # ìë™ ê³„ì‚°

def test_get_health_info(auth_token):
    """ê±´ê°• ì •ë³´ ì¡°íšŒ"""
    response = client.get(
        "/api/v1/users/health-info",
        headers={"Authorization": f"Bearer {auth_token}"}
    )
    assert response.status_code == 200
```

## ì™„ë£Œ ê¸°ì¤€
- [ ] ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ/ìˆ˜ì • API ì‘ë™
- [ ] ê±´ê°• ì •ë³´ ë“±ë¡/ì¡°íšŒ API ì‘ë™
- [ ] BMI ìë™ ê³„ì‚° ë¡œì§ ì‘ë™
- [ ] JWT ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ ì ìš©
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼

## í…ŒìŠ¤íŠ¸

```bash
# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
docker-compose exec core_api pytest tests/test_users.py -v

# Swagger UI í…ŒìŠ¤íŠ¸
# http://localhost:8000/docs
# 1. POST /api/v1/auth/login/socialë¡œ í† í° ë°›ê¸°
# 2. Authorize ë²„íŠ¼ìœ¼ë¡œ í† í° ì„¤ì •
# 3. GET /api/v1/users/me í…ŒìŠ¤íŠ¸
# 4. PUT /api/v1/users/me í…ŒìŠ¤íŠ¸
# 5. POST /api/v1/users/health-info í…ŒìŠ¤íŠ¸
```

## ì™„ë£Œ ë³´ê³ 
ì™„ë£Œë˜ë©´ ë‹¤ìŒì„ ë³´ê³ í•´ì¤˜:
1. "Day 9-12 ì™„ë£Œ"
2. êµ¬í˜„ëœ API ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡ (4ê°œ)
3. í…ŒìŠ¤íŠ¸ ê²°ê³¼
4. ë‹¤ìŒ ë‹¨ê³„ ì¤€ë¹„ì‚¬í•­ (Day 13-16ë¡œ ì§„í–‰ ê°€ëŠ¥ ì—¬ë¶€)
```

---

#### Day 13-16: ê°€ì¡± í”„ë¡œí•„ ê´€ë¦¬

```markdown
# Day 13-16: ê°€ì¡± í”„ë¡œí•„ ê´€ë¦¬ API

## ëª©í‘œ
ê°€ì¡± í”„ë¡œí•„ CRUDì™€ êµ¬ë… í”Œëœë³„ ì œí•œ ë¡œì§ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

## ì°¸ì¡°
- ê°œë°œ_ì²´í¬ë¦¬ìŠ¤íŠ¸_v1.2.md: Day 13-16
- TRD v1.2: ì„¹ì…˜ 5.3 (Family Service API)
- PRD v1.2: ì„¹ì…˜ 4.2 (ê°€ì¡± í”„ë¡œí•„ ê´€ë¦¬)
- PRD v1.2: ì„¹ì…˜ 6.1 (êµ¬ë… í”Œëœë³„ ì œí•œ)

## ìš”êµ¬ì‚¬í•­

### 1. core_api/schemas/family.py

```python
from pydantic import BaseModel
from typing import Optional, Dict, Any
from datetime import date, datetime
from core_api.models.family import Relationship
from core_api.models.user import Gender

class CreateFamilyProfileRequest(BaseModel):
    name: str
    relationship: Relationship
    birth_date: Optional[date] = None
    gender: Optional[Gender] = None
    profile_image_url: Optional[str] = None
    health_info: Optional[Dict[str, Any]] = None

class UpdateFamilyProfileRequest(BaseModel):
    name: Optional[str] = None
    birth_date: Optional[date] = None
    gender: Optional[Gender] = None
    profile_image_url: Optional[str] = None
    health_info: Optional[Dict[str, Any]] = None

class FamilyProfileResponse(BaseModel):
    id: str
    name: str
    relationship: Relationship
    birth_date: Optional[date]
    gender: Optional[Gender]
    profile_image_url: Optional[str]
    health_info: Optional[Dict[str, Any]]
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True

class FamilyProfileListResponse(BaseModel):
    total: int
    limit: int  # êµ¬ë… í”Œëœì— ë”°ë¥¸ ì œí•œ
    profiles: list[FamilyProfileResponse]
```

### 2. core_api/services/family_service.py

```python
from sqlalchemy.orm import Session
from typing import List
from fastapi import HTTPException, status

from core_api.models.user import User
from core_api.models.family import FamilyProfile, Relationship
from core_api.models.subscription import Subscription, PlanType
from core_api.schemas.family import (
    CreateFamilyProfileRequest,
    UpdateFamilyProfileRequest,
    FamilyProfileResponse
)
from datetime import datetime

class FamilyService:
    
    def __init__(self, db: Session):
        self.db = db
    
    def _get_subscription_limit(self, user: User) -> int:
        """ì‚¬ìš©ìì˜ êµ¬ë… í”Œëœì— ë”°ë¥¸ ê°€ì¡± í”„ë¡œí•„ ì œí•œ ìˆ˜"""
        subscription = self.db.query(Subscription).filter(
            Subscription.user_id == user.id,
            Subscription.status == "active"
        ).first()
        
        if not subscription or subscription.plan_type == PlanType.FREE:
            # Free: ë³¸ì¸ + 1ëª… = ì´ 2ëª…
            return 2
        else:
            # Basic, Premium, Family: ë¬´ì œí•œ (ì‹¤ì§ˆì ìœ¼ë¡œ 100ëª…)
            return 100
    
    def get_family_profiles(self, user: User) -> List[FamilyProfile]:
        """ì‚¬ìš©ìì˜ ê°€ì¡± í”„ë¡œí•„ ëª©ë¡ ì¡°íšŒ"""
        profiles = self.db.query(FamilyProfile).filter(
            FamilyProfile.user_id == user.id,
            FamilyProfile.deleted_at.is_(None)
        ).order_by(
            # selfë¥¼ ë¨¼ì €, ë‚˜ë¨¸ì§€ëŠ” ìƒì„±ì¼ ìˆœ
            FamilyProfile.relationship == Relationship.SELF.desc(),
            FamilyProfile.created_at
        ).all()
        
        return profiles
    
    def get_family_profile(self, user: User, family_id: str) -> FamilyProfile:
        """íŠ¹ì • ê°€ì¡± í”„ë¡œí•„ ì¡°íšŒ"""
        profile = self.db.query(FamilyProfile).filter(
            FamilyProfile.id == family_id,
            FamilyProfile.user_id == user.id,
            FamilyProfile.deleted_at.is_(None)
        ).first()
        
        if not profile:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="Family profile not found"
            )
        
        return profile
    
    def create_family_profile(self, user: User, data: CreateFamilyProfileRequest) -> FamilyProfile:
        """ê°€ì¡± í”„ë¡œí•„ ìƒì„±"""
        
        # 1. êµ¬ë… í”Œëœ ì œí•œ í™•ì¸
        existing_profiles = self.get_family_profiles(user)
        limit = self._get_subscription_limit(user)
        
        if len(existing_profiles) >= limit:
            raise HTTPException(
                status_code=status.HTTP_402_PAYMENT_REQUIRED,
                detail=f"Family profile limit reached. Upgrade to add more members. Current limit: {limit}"
            )
        
        # 2. self í”„ë¡œí•„ì€ í•˜ë‚˜ë§Œ ê°€ëŠ¥
        if data.relationship == Relationship.SELF:
            self_exists = any(p.relationship == Relationship.SELF for p in existing_profiles)
            if self_exists:
                raise HTTPException(
                    status_code=status.HTTP_400_BAD_REQUEST,
                    detail="Self profile already exists"
                )
        
        # 3. í”„ë¡œí•„ ìƒì„±
        profile = FamilyProfile(
            user_id=user.id,
            name=data.name,
            relationship=data.relationship,
            birth_date=data.birth_date,
            gender=data.gender,
            profile_image_url=data.profile_image_url,
            health_info=data.health_info or {}
        )
        
        self.db.add(profile)
        self.db.commit()
        self.db.refresh(profile)
        
        return profile
    
    def update_family_profile(
        self,
        user: User,
        family_id: str,
        data: UpdateFamilyProfileRequest
    ) -> FamilyProfile:
        """ê°€ì¡± í”„ë¡œí•„ ìˆ˜ì •"""
        profile = self.get_family_profile(user, family_id)
        
        update_data = data.model_dump(exclude_unset=True)
        for key, value in update_data.items():
            setattr(profile, key, value)
        
        profile.updated_at = datetime.utcnow()
        self.db.commit()
        self.db.refresh(profile)
        
        return profile
    
    def delete_family_profile(self, user: User, family_id: str) -> None:
        """ê°€ì¡± í”„ë¡œí•„ ì‚­ì œ (ì†Œí”„íŠ¸ ì‚­ì œ)"""
        profile = self.get_family_profile(user, family_id)
        
        # self í”„ë¡œí•„ì€ ì‚­ì œ ë¶ˆê°€
        if profile.relationship == Relationship.SELF:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="Cannot delete self profile"
            )
        
        profile.deleted_at = datetime.utcnow()
        self.db.commit()
```

### 3. core_api/routers/families.py

```python
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session

from core_api.database import get_db
from core_api.dependencies import get_current_user
from core_api.models.user import User
from core_api.schemas.family import (
    CreateFamilyProfileRequest,
    UpdateFamilyProfileRequest,
    FamilyProfileResponse,
    FamilyProfileListResponse
)
from core_api.services.family_service import FamilyService

router = APIRouter(prefix="/api/v1/families", tags=["Family"])

@router.post("", response_model=FamilyProfileResponse, status_code=status.HTTP_201_CREATED)
def create_family_profile(
    data: CreateFamilyProfileRequest,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """
    ê°€ì¡± í”„ë¡œí•„ ìƒì„±
    
    êµ¬ë… í”Œëœì— ë”°ë¼ ì œí•œ:
    - **Free**: ë³¸ì¸ + 1ëª… (ì´ 2ëª…)
    - **Basic/Premium/Family**: ë¬´ì œí•œ
    
    - **name**: ì´ë¦„ (í•„ìˆ˜)
    - **relationship**: ê´€ê³„ (í•„ìˆ˜, self/parent/spouse/child/sibling/other)
    - **birth_date**: ìƒë…„ì›”ì¼ (ì„ íƒ)
    - **gender**: ì„±ë³„ (ì„ íƒ)
    - **profile_image_url**: í”„ë¡œí•„ ì´ë¯¸ì§€ URL (ì„ íƒ)
    - **health_info**: ê±´ê°• ì •ë³´ (ì„ íƒ, JSON)
    """
    family_service = FamilyService(db)
    
    try:
        profile = family_service.create_family_profile(current_user, data)
        return profile
    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=str(e)
        )

@router.get("", response_model=FamilyProfileListResponse)
def get_family_profiles(
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """
    ê°€ì¡± í”„ë¡œí•„ ëª©ë¡ ì¡°íšŒ
    
    ë³¸ì¸(self) í”„ë¡œí•„ì„ í¬í•¨í•œ ëª¨ë“  ê°€ì¡± í”„ë¡œí•„ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
    """
    family_service = FamilyService(db)
    
    profiles = family_service.get_family_profiles(current_user)
    limit = family_service._get_subscription_limit(current_user)
    
    return FamilyProfileListResponse(
        total=len(profiles),
        limit=limit,
        profiles=profiles
    )

@router.get("/{family_id}", response_model=FamilyProfileResponse)
def get_family_profile(
    family_id: str,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """
    íŠ¹ì • ê°€ì¡± í”„ë¡œí•„ ì¡°íšŒ
    
    - **family_id**: ê°€ì¡± í”„ë¡œí•„ ID
    """
    family_service = FamilyService(db)
    
    try:
        profile = family_service.get_family_profile(current_user, family_id)
        return profile
    except HTTPException:
        raise

@router.put("/{family_id}", response_model=FamilyProfileResponse)
def update_family_profile(
    family_id: str,
    data: UpdateFamilyProfileRequest,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """
    ê°€ì¡± í”„ë¡œí•„ ìˆ˜ì •
    
    - **family_id**: ê°€ì¡± í”„ë¡œí•„ ID
    - **name**: ì´ë¦„ (ì„ íƒ)
    - **birth_date**: ìƒë…„ì›”ì¼ (ì„ íƒ)
    - **gender**: ì„±ë³„ (ì„ íƒ)
    - **profile_image_url**: í”„ë¡œí•„ ì´ë¯¸ì§€ URL (ì„ íƒ)
    - **health_info**: ê±´ê°• ì •ë³´ (ì„ íƒ, JSON)
    """
    family_service = FamilyService(db)
    
    try:
        profile = family_service.update_family_profile(current_user, family_id, data)
        return profile
    except HTTPException:
        raise

@router.delete("/{family_id}", status_code=status.HTTP_204_NO_CONTENT)
def delete_family_profile(
    family_id: str,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """
    ê°€ì¡± í”„ë¡œí•„ ì‚­ì œ (ì†Œí”„íŠ¸ ì‚­ì œ)
    
    - **family_id**: ê°€ì¡± í”„ë¡œí•„ ID
    
    ì£¼ì˜: self í”„ë¡œí•„ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
    """
    family_service = FamilyService(db)
    
    try:
        family_service.delete_family_profile(current_user, family_id)
        return
    except HTTPException:
        raise
```

### 4. core_api/main.py ì—…ë°ì´íŠ¸

```python
from core_api.routers import auth, users, families

# ...

app.include_router(auth.router)
app.include_router(users.router)
app.include_router(families.router)  # ì¶”ê°€
```

### 5. tests/test_families.py

```python
import pytest
from fastapi.testclient import TestClient
from core_api.main import app

client = TestClient(app)

def test_create_family_profile(auth_token):
    """ê°€ì¡± í”„ë¡œí•„ ìƒì„±"""
    response = client.post(
        "/api/v1/families",
        headers={"Authorization": f"Bearer {auth_token}"},
        json={
            "name": "í™ì–´ë¨¸ë‹ˆ",
            "relationship": "parent",
            "birth_date": "1955-03-15",
            "gender": "female"
        }
    )
    assert response.status_code == 201
    data = response.json()
    assert data["name"] == "í™ì–´ë¨¸ë‹ˆ"
    assert data["relationship"] == "parent"

def test_create_family_profile_exceed_limit(auth_token_free):
    """Free í”Œëœ ì œí•œ ì´ˆê³¼ (3ë²ˆì§¸ í”„ë¡œí•„ ìƒì„± ì‹œ 402)"""
    
    # 1ë²ˆì§¸ í”„ë¡œí•„ (ë³¸ì¸ì€ ìë™ ìƒì„±ë¨)
    # 2ë²ˆì§¸ í”„ë¡œí•„ ìƒì„±
    client.post("/api/v1/families", headers={"Authorization": f"Bearer {auth_token_free}"}, json={"name": "ê°€ì¡±1", "relationship": "parent"})
    
    # 3ë²ˆì§¸ í”„ë¡œí•„ ìƒì„± ì‹œ ì œí•œ
    response = client.post(
        "/api/v1/families",
        headers={"Authorization": f"Bearer {auth_token_free}"},
        json={"name": "ê°€ì¡±2", "relationship": "spouse"}
    )
    assert response.status_code == 402
    assert "limit reached" in response.json()["detail"].lower()

def test_get_family_profiles(auth_token):
    """ê°€ì¡± í”„ë¡œí•„ ëª©ë¡ ì¡°íšŒ"""
    response = client.get(
        "/api/v1/families",
        headers={"Authorization": f"Bearer {auth_token}"}
    )
    assert response.status_code == 200
    data = response.json()
    assert "total" in data
    assert "limit" in data
    assert "profiles" in data

def test_get_family_profile(auth_token, family_id):
    """íŠ¹ì • ê°€ì¡± í”„ë¡œí•„ ì¡°íšŒ"""
    response = client.get(
        f"/api/v1/families/{family_id}",
        headers={"Authorization": f"Bearer {auth_token}"}
    )
    assert response.status_code == 200

def test_update_family_profile(auth_token, family_id):
    """ê°€ì¡± í”„ë¡œí•„ ìˆ˜ì •"""
    response = client.put(
        f"/api/v1/families/{family_id}",
        headers={"Authorization": f"Bearer {auth_token}"},
        json={"name": "í™ì–´ë¨¸ë‹ˆ (ìˆ˜ì •)"}
    )
    assert response.status_code == 200
    data = response.json()
    assert data["name"] == "í™ì–´ë¨¸ë‹ˆ (ìˆ˜ì •)"

def test_delete_family_profile(auth_token, family_id):
    """ê°€ì¡± í”„ë¡œí•„ ì‚­ì œ"""
    response = client.delete(
        f"/api/v1/families/{family_id}",
        headers={"Authorization": f"Bearer {auth_token}"}
    )
    assert response.status_code == 204

def test_delete_self_profile_fail(auth_token, self_profile_id):
    """self í”„ë¡œí•„ ì‚­ì œ ì‹œë„ (ì‹¤íŒ¨)"""
    response = client.delete(
        f"/api/v1/families/{self_profile_id}",
        headers={"Authorization": f"Bearer {auth_token}"}
    )
    assert response.status_code == 400
```

## ì™„ë£Œ ê¸°ì¤€
- [ ] ê°€ì¡± í”„ë¡œí•„ CRUD API ì‘ë™
- [ ] êµ¬ë… í”Œëœë³„ ì œí•œ ë¡œì§ ì‘ë™ (Free: 2ëª…, ìœ ë£Œ: ë¬´ì œí•œ)
- [ ] self í”„ë¡œí•„ì€ ì‚­ì œ ë¶ˆê°€
- [ ] ì†Œí”„íŠ¸ ì‚­ì œ ì‘ë™
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼

## í…ŒìŠ¤íŠ¸

```bash
# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
docker-compose exec core_api pytest tests/test_families.py -v

# Swagger UI í…ŒìŠ¤íŠ¸
# http://localhost:8000/docs
# 1. ì¸ì¦ í›„ POST /api/v1/familiesë¡œ í”„ë¡œí•„ ìƒì„±
# 2. GET /api/v1/familiesë¡œ ëª©ë¡ ì¡°íšŒ
# 3. GET /api/v1/families/{family_id}ë¡œ íŠ¹ì • í”„ë¡œí•„ ì¡°íšŒ
# 4. PUT /api/v1/families/{family_id}ë¡œ ìˆ˜ì •
# 5. DELETE /api/v1/families/{family_id}ë¡œ ì‚­ì œ
```

## ì™„ë£Œ ë³´ê³ 
ì™„ë£Œë˜ë©´ ë‹¤ìŒì„ ë³´ê³ í•´ì¤˜:
1. "Day 13-16 ì™„ë£Œ"
2. êµ¬í˜„ëœ API ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡ (5ê°œ)
3. êµ¬ë… í”Œëœë³„ ì œí•œ ë¡œì§ í…ŒìŠ¤íŠ¸ ê²°ê³¼
4. ë‹¤ìŒ ë‹¨ê³„ ì¤€ë¹„ì‚¬í•­ (Day 17-25ë¡œ ì§„í–‰ ê°€ëŠ¥ ì—¬ë¶€)
```

---

ì´ë ‡ê²Œ ê³„ì† ì‘ì„±í•˜ë©´ ë„ˆë¬´ ê¸¸ì–´ì§€ë¯€ë¡œ, **ë‚˜ë¨¸ì§€ Dayë“¤ì˜ í”„ë¡¬í”„íŠ¸ë¥¼ ìš”ì•½ëœ í˜•íƒœë¡œ ì‘ì„±**í•˜ê² ìŠµë‹ˆë‹¤.

---

### ğŸ”¹ Week 3-4: ìŒì„± ìƒë‹´ ì‹œìŠ¤í…œ (Day 17-25)

```markdown
# Day 17-25: OpenAI Realtime API ìŒì„± ìƒë‹´ ì‹œìŠ¤í…œ

[ì „ì²´ ë‚´ìš©ì€ ì•ì„œ ì‘ì„±í•œ Day 17-25 í”„ë¡¬í”„íŠ¸ ì°¸ì¡°]

## í•µì‹¬ ìš”êµ¬ì‚¬í•­
1. conversation_service/main.py: WebSocket ì—”ë“œí¬ì¸íŠ¸
2. conversation_service/realtime.py: OpenAI Realtime API í´ë¼ì´ì–¸íŠ¸
3. conversation_service/characters.py: 10ê°œ AI ìºë¦­í„° í”„ë¡¬í”„íŠ¸ ë¡œë“œ
4. conversation_service/rag.py: Chroma DB RAG ì‹œìŠ¤í…œ
5. Redis ì„¸ì…˜ ê´€ë¦¬
6. TRD ì„¹ì…˜ 6, 7 ì°¸ì¡°
7. AIìºë¦­í„° ê°€ì´ë“œ ì „ì²´ ì°¸ì¡°

## ì™„ë£Œ ê¸°ì¤€
- [ ] WebSocket ì–‘ë°©í–¥ í†µì‹ 
- [ ] OpenAI Realtime API ì—°ê²°
- [ ] 10ê°œ ìºë¦­í„° ê°ê° í…ŒìŠ¤íŠ¸
- [ ] RAG ì‹œìŠ¤í…œ ì‘ë™
- [ ] conversation_messages í…Œì´ë¸”ì— ì €ì¥
```

---

### ğŸ”¹ Week 4-5: ì›¨ì–´ëŸ¬ë¸” & ê±´ê°• ë°ì´í„° (Day 26-34)

```markdown
# Day 26-29: ì›¨ì–´ëŸ¬ë¸” ë°ì´í„° ìˆ˜ì§‘ (Apple HealthKit / Android Health Connect)

## ëª©í‘œ
Apple HealthKitê³¼ Android Health Connect ì—°ë™ API êµ¬í˜„

## ì°¸ì¡°
- TRD v1.2: ì„¹ì…˜ 8 (ì›¨ì–´ëŸ¬ë¸” ì—°ë™)
- TRD v1.2: ì„¹ì…˜ 5.5 (Wearable Service API)

## í•µì‹¬ ìš”êµ¬ì‚¬í•­
1. core_api/models/health_data.py ìƒì„± (TRD 4.2.5 ì°¸ì¡°)
2. core_api/routers/wearables.py
   - POST /api/v1/wearables/sync (í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë°ì´í„° ì „ì†¡)
   - GET /api/v1/wearables/data (ë°ì´í„° ì¡°íšŒ)
3. core_api/services/wearable_service.py
   - ë°ì´í„° ê²€ì¦ ë° ì €ì¥
   - ì¼ë³„/ì£¼ë³„/ì›”ë³„ í†µê³„ ê³„ì‚°

## ë°ì´í„° íƒ€ì… (TRD 8.2 ì°¸ì¡°)
- ê±¸ìŒ ìˆ˜, ìˆ˜ë©´, ì‹¬ë°•ìˆ˜, í˜ˆì••, ì²´ì¤‘, ìš´ë™, ì¹¼ë¡œë¦¬

---

# Day 30-34: ê±´ê°• ì½”ì¹­ ì•Œê³ ë¦¬ì¦˜

## ëª©í‘œ
ì›¨ì–´ëŸ¬ë¸” ë°ì´í„° ê¸°ë°˜ AI ê±´ê°• ì½”ì¹­ ë¡œì§

## ì°¸ì¡°
- TRD v1.2: ì„¹ì…˜ 7.4 (ê±´ê°• ì½”ì¹­ ì•Œê³ ë¦¬ì¦˜)

## í•µì‹¬ ìš”êµ¬ì‚¬í•­
1. core_api/services/coaching_service.py
   - analyze_health_trends(): ì£¼ê°„ ê±´ê°• íŠ¸ë Œë“œ ë¶„ì„
   - generate_coaching_message(): Claude APIë¡œ ì½”ì¹­ ë©”ì‹œì§€ ìƒì„±
2. í•˜ë£¨ 1íšŒ ìë™ ë¶„ì„ ìŠ¤ì¼€ì¤„ëŸ¬ (í–¥í›„ êµ¬í˜„)
```

---

### ğŸ”¹ Week 6-7: êµ¬ë… & UI (Day 35-52)

```markdown
# Day 35-42: êµ¬ë… ê´€ë¦¬

## Backend (Day 35-38)
- core_api/routers/subscriptions.py
- RevenueCat Webhook ì²˜ë¦¬
- TRD ì„¹ì…˜ 5.6 ì°¸ì¡°

## Frontend (Day 39-42)
- Flutter êµ¬ë… í™”ë©´
- in_app_purchase, purchases_flutter íŒ¨í‚¤ì§€
- Apple IAP, Google Play Billing

---

# Day 43-52: Flutter UI ê°œë°œ

## Day 43-46: ê¸°ë³¸ UI
- ìŠ¤í”Œë˜ì‹œ, ì˜¨ë³´ë”©, ë¡œê·¸ì¸ í™”ë©´
- Riverpod ìƒíƒœ ê´€ë¦¬ ì„¤ì •

## Day 47-48: í™ˆ & í”„ë¡œí•„
- í™ˆ í™”ë©´ (ì˜¤ëŠ˜ì˜ ê±´ê°•, ìµœê·¼ ìƒë‹´)
- í”„ë¡œí•„ ì„¤ì • í™”ë©´

## Day 49-52: ìŒì„± ìƒë‹´ UI
- ìºë¦­í„° ì„ íƒ í™”ë©´
- ìŒì„± ìƒë‹´ í™”ë©´ (WebSocket ì—°ê²°)
- ì˜¤ë””ì˜¤ ë…¹ìŒ/ì¬ìƒ
```

---

### ğŸ”¹ Week 8: ë°°í¬ ì¤€ë¹„ (Day 53-56)

```markdown
# Day 53-54: í†µí•© í…ŒìŠ¤íŠ¸

- ì „ì²´ API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
- ìŒì„± ìƒë‹´ E2E í…ŒìŠ¤íŠ¸
- ë¶€í•˜ í…ŒìŠ¤íŠ¸ (locust ë˜ëŠ” k6)

---

# Day 55-56: Fly.io ë°°í¬

## ì°¸ì¡°
- TRD v1.2: ì„¹ì…˜ 10 (ì¸í”„ë¼ ë° ë°°í¬)
- ê°œë°œ_ì²´í¬ë¦¬ìŠ¤íŠ¸_v1.2.md: Day 55-56

## ìš”êµ¬ì‚¬í•­
1. Fly.io ê³„ì • ìƒì„± ë° CLI ì„¤ì¹˜
2. fly.core.toml, fly.conversation.toml ì‘ì„± (TRD 10.2 ì°¸ì¡°)
3. Fly.io Postgres ìƒì„±
4. Upstash Redis ì—°ë™
5. Fly.io Secrets ì„¤ì •
6. GitHub Actions CI/CD íŒŒì´í”„ë¼ì¸
7. í…ŒìŠ¤íŠ¸ ë°°í¬ ë° smoke test

## ë°°í¬ í”„ë¡œì„¸ìŠ¤
```bash
# Fly.io ì•± ìƒì„±
fly launch --config fly.core.toml --no-deploy
fly launch --config fly.conversation.toml --no-deploy

# Postgres ìƒì„±
fly postgres create --name healthai-db --region hkg

# Secrets ì„¤ì •
fly secrets set OPENAI_API_KEY=sk-xxx DATABASE_URL=postgres://...

# ë°°í¬
fly deploy --config fly.core.toml
fly deploy --config fly.conversation.toml

# ë§ˆì´ê·¸ë ˆì´ì…˜
fly ssh console --app healthai-core-api
> alembic upgrade head
```

## ì™„ë£Œ ê¸°ì¤€
- [ ] Fly.io ë°°í¬ ì„±ê³µ
- [ ] Core API ì ‘ì† ê°€ëŠ¥
- [ ] Conversation Service WebSocket ì‘ë™
- [ ] GitHub Actions ìë™ ë°°í¬ ì‘ë™
```

---

## 3. Phase 1.5: ì•„ì¹¨ ë£¨í‹´ ê¸°ëŠ¥ (1ì£¼)

```markdown
# Phase 1.5: ì•„ì¹¨ ë£¨í‹´ ì²´í¬ ê¸°ëŠ¥ (Day 57-61)

## ëª©í‘œ
íƒ€ì´íƒ„ì˜ ì•„ì¹¨ì¼ê¸° ì•± UIë¥¼ ì°¸ê³ í•˜ì—¬ ì•„ì¹¨ ë£¨í‹´ ì²´í¬ ê¸°ëŠ¥ êµ¬í˜„

## ì°¸ì¡°
- PRD v1.2: F-ROUTINE-001 (ëŒ€í­ ë³´ê°•ëœ ì„¹ì…˜)
- TRD v1.2: ì„¹ì…˜ 4.2.12~14 (ë£¨í‹´ í…Œì´ë¸”)
- TRD v1.2: ì„¹ì…˜ 5.7 (Routine Service API)

## Backend (Day 57-59)
### Day 57-58: ë°ì´í„°ë² ì´ìŠ¤ (ì´ë¯¸ Day 3-4ì—ì„œ ì™„ë£Œë¨)
- morning_routines, routine_check_records, routine_notifications í…Œì´ë¸”

### Day 58-59: Routine API
- core_api/routers/routines.py (6ê°œ ì—”ë“œí¬ì¸íŠ¸)
  - GET /api/v1/routines/items
  - POST /api/v1/routines/check
  - GET /api/v1/routines/check/today
  - GET /api/v1/routines/stats/weekly
  - POST /api/v1/routines/notifications
  - GET /api/v1/routines/notifications

### Day 59-60: ì•Œë¦¼ ìŠ¤ì¼€ì¤„ëŸ¬
- FCM (Firebase Cloud Messaging) í†µí•©
- ë§¤ì¼ ì„¤ì • ì‹œê°„ì— í‘¸ì‹œ ì•Œë¦¼

## Frontend (Day 57-60)
### Day 57-58: ë£¨í‹´ ì²´í¬ í™”ë©´ UI
- íƒ€ì´íƒ„ ì•± ì°¸ê³ 
- 8ê°œ ì²´í¬ë°•ìŠ¤ (ì´ë¶ˆ ì •ë¦¬, ë¬¼ ë§ˆì‹œê¸°, ...)
- ì§„í–‰ë¥  í‘œì‹œ (6/8 ì™„ë£Œ)
- ê¸°ë¶„/ì—ë„ˆì§€ ì„ íƒ (5ë‹¨ê³„)
- ì• ë‹ˆë©”ì´ì…˜ (ì²´í¬ ì‹œ)

### Day 58-59: ì…ë ¥ í•„ë“œ
- ëª©í‘œ 1ê°€ì§€ (TextField, ìµœëŒ€ 100ì)
- ì¼ì • 3ê°€ì§€ (ListView, ê° ìµœëŒ€ 50ì)
- ê°ì‚¬ ì¼ê¸° 3ê°€ì§€ (ì„ íƒ, ê° ìµœëŒ€ 50ì)
- ì €ì¥ ë²„íŠ¼
- API ì—°ë™

### Day 59-60: ë£¨í‹´ í†µê³„ í™”ë©´
- ì£¼ê°„ ë‹¬ì„±ë¥  ì°¨íŠ¸ (fl_chart íŒ¨í‚¤ì§€)
- ì—°ì† ë‹¬ì„±ì¼
- ê°€ì¥ ë§ì´ ì™„ë£Œí•œ ë£¨í‹´ TOP 3

### Day 60: ì•Œë¦¼ ì„¤ì •
- ì„¤ì • í™”ë©´ ì¶”ê°€
- TimePicker (ì•Œë¦¼ ì‹œê°„ ì„ íƒ)
- ON/OFF ìŠ¤ìœ„ì¹˜
- FCM í† í° ë“±ë¡

## í…ŒìŠ¤íŠ¸ (Day 61)
- í†µí•© í…ŒìŠ¤íŠ¸: ë£¨í‹´ ì²´í¬ â†’ ì €ì¥ â†’ í†µê³„
- ì•Œë¦¼ ìˆ˜ì‹  í…ŒìŠ¤íŠ¸ (iOS/Android)

## ì™„ë£Œ ê¸°ì¤€
- [ ] 8ê°œ ë£¨í‹´ í•­ëª© ì²´í¬ ê°€ëŠ¥
- [ ] ì˜¤ëŠ˜ì˜ ì»¨ë””ì…˜ ì…ë ¥ ê°€ëŠ¥
- [ ] ëª©í‘œ/ì¼ì •/ê°ì‚¬ ì¼ê¸° ì…ë ¥ ê°€ëŠ¥
- [ ] ì£¼ê°„ í†µê³„ í™”ë©´ ì‘ë™
- [ ] ì•Œë¦¼ ì„¤ì • ë° ìˆ˜ì‹  ì‘ë™
```

---

## 4. Phase 2: ë² íƒ€ í…ŒìŠ¤íŠ¸ (2ì£¼)

```markdown
# Phase 2: ë² íƒ€ í…ŒìŠ¤íŠ¸ (2ì£¼, 2026-01-22 ~ 2026-02-04)

## ëª©í‘œ
100ëª… ë² íƒ€ í…ŒìŠ¤í„°ë¡œ ì‹¤ì œ ì‚¬ìš© í…ŒìŠ¤íŠ¸ ë° í”¼ë“œë°± ìˆ˜ì§‘

## Week 1: ë² íƒ€ ë°°í¬ ë° ì´ˆê¸° í…ŒìŠ¤íŠ¸

### ì¤€ë¹„ì‚¬í•­
- [ ] ë² íƒ€ í…ŒìŠ¤í„° 100ëª… ëª¨ì§‘ (TestFlight, Google Play Internal Testing)
- [ ] Fly.io í”„ë¡œë•ì…˜ í™˜ê²½ í™•ì¸
- [ ] Sentry ì˜¤ë¥˜ ì¶”ì  í™œì„±í™”
- [ ] Firebase Analytics ì„¤ì •
- [ ] ì‚¬ìš©ì ê°€ì´ë“œ ë¬¸ì„œ ì‘ì„±

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
1. **íšŒì›ê°€ì… ë° ë¡œê·¸ì¸**
   - ì¹´ì¹´ì˜¤/êµ¬ê¸€/ì• í”Œ ì†Œì…œ ë¡œê·¸ì¸
   - í”„ë¡œí•„ ì„¤ì •

2. **ê°€ì¡± í”„ë¡œí•„ ê´€ë¦¬**
   - ê°€ì¡± í”„ë¡œí•„ ì¶”ê°€ (Free í”Œëœ ì œí•œ í™•ì¸)
   - ê±´ê°• ì •ë³´ ì…ë ¥

3. **ìŒì„± ìƒë‹´**
   - 10ê°œ ìºë¦­í„° ê°ê° í…ŒìŠ¤íŠ¸
   - ìŒì„± ì¸ì‹ ì •í™•ë„ í™•ì¸
   - ì‘ë‹µ ì†ë„ í™•ì¸ (ëª©í‘œ: <500ms)

4. **ì•„ì¹¨ ë£¨í‹´ ì²´í¬**
   - ë£¨í‹´ ì²´í¬ ë° ì €ì¥
   - ì•Œë¦¼ ìˆ˜ì‹  í™•ì¸
   - ì£¼ê°„ í†µê³„ í™•ì¸

5. **êµ¬ë… ê´€ë¦¬**
   - êµ¬ë… í”Œëœ ë³€ê²½ (Free â†’ Premium)
   - ê°€ì¡± í”„ë¡œí•„ ì œí•œ í•´ì œ í™•ì¸

### ìˆ˜ì§‘í•  ë°ì´í„°
- ì„¸ì…˜ ê¸¸ì´, ìŒì„± ìƒë‹´ íšŸìˆ˜
- ì—ëŸ¬ ë°œìƒ ë¹ˆë„ (Sentry)
- ì‚¬ìš©ì ì´íƒˆ ì‹œì 
- í‰ê·  ì‘ë‹µ ì‹œê°„
- ì‚¬ìš©ì í”¼ë“œë°± (ì„¤ë¬¸ ì¡°ì‚¬)

## Week 2: ë²„ê·¸ ìˆ˜ì • ë° ìµœì í™”

### ì£¼ìš” ì‘ì—…
- [ ] ë²„ê·¸ ìˆ˜ì • (Sentry ê¸°ì¤€ Critical/High)
- [ ] UI/UX ê°œì„  (ì‚¬ìš©ì í”¼ë“œë°± ê¸°ì¤€)
- [ ] ì„±ëŠ¥ ìµœì í™” (ì‘ë‹µ ì†ë„, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰)
- [ ] ì ‘ê·¼ì„± ê°œì„  (WCAG 2.1 AA ì¤€ìˆ˜)
- [ ] ë¬¸ì„œ ì—…ë°ì´íŠ¸

### ìµœì¢… ì ê²€
- [ ] ëª¨ë“  Critical ë²„ê·¸ í•´ê²°
- [ ] í‰ê·  ìŒì„± ì‘ë‹µ ì†ë„ <500ms
- [ ] ì•± í¬ë˜ì‹œìœ¨ <1%
- [ ] NPS ì ìˆ˜ ìˆ˜ì§‘ (ëª©í‘œ: >50)

## ì™„ë£Œ ê¸°ì¤€
- [ ] 100ëª… ë² íƒ€ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] ì£¼ìš” ë²„ê·¸ ëª¨ë‘ ìˆ˜ì •
- [ ] ì‚¬ìš©ì ë§Œì¡±ë„ >85%
- [ ] ì •ì‹ ì¶œì‹œ ì¤€ë¹„ ì™„ë£Œ
```

---

## 5. Phase 3: ì •ì‹ ì¶œì‹œ

```markdown
# Phase 3: ì •ì‹ ì¶œì‹œ (2026-02-12)

## ì¶œì‹œ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Backend (Fly.io)
- [ ] Fly.io í”„ë¡œë•ì…˜ í™˜ê²½ ìµœì¢… í™•ì¸
- [ ] PostgreSQL ë°±ì—… ì„¤ì • (ìë™ ìŠ¤ëƒ…ìƒ·)
- [ ] Upstash Redis ì•ˆì •ì„± í™•ì¸
- [ ] Cloudflare R2 ë²„í‚· ì„¤ì •
- [ ] ì»¤ìŠ¤í…€ ë„ë©”ì¸ ì„¤ì • (ì˜ˆ: api.healthai.com)
- [ ] TLS/SSL ì¸ì¦ì„œ í™•ì¸
- [ ] ìµœì†Œ ì¸ìŠ¤í„´ìŠ¤ ìˆ˜ ì„¤ì • (auto_stop_machines: false)
- [ ] API Rate Limiting í™œì„±í™”
- [ ] Fly.io Metrics ëŒ€ì‹œë³´ë“œ ì„¤ì •
- [ ] Sentry ì˜¤ë¥˜ ì¶”ì  ìµœì¢… í™•ì¸
- [ ] Slack ì•Œë¦¼ ì—°ë™

### Frontend
- [ ] App Store ì œì¶œ (iOS)
- [ ] Google Play ì œì¶œ (Android)
- [ ] ì•± ìŠ¤í† ì–´ ìŠ¤í¬ë¦°ìƒ· (5-10ì¥)
- [ ] ì•± ì„¤ëª… ì‘ì„± (í•œêµ­ì–´, ì˜ì–´)
- [ ] ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ ì›¹í˜ì´ì§€
- [ ] ì´ìš©ì•½ê´€ ì›¹í˜ì´ì§€
- [ ] ê³ ê°ì§€ì› ì´ë©”ì¼ ì„¤ì •

### ë§ˆì¼€íŒ…
- [ ] ëœë”© í˜ì´ì§€ ì˜¤í”ˆ
- [ ] ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ì‘ì„±
- [ ] SNS ê³„ì • ìƒì„± (ì¸ìŠ¤íƒ€ê·¸ë¨, í˜ì´ìŠ¤ë¶)
- [ ] í”„ë ˆìŠ¤í‚· ì¤€ë¹„
- [ ] ì¶œì‹œ ë³´ë„ìë£Œ ë°°í¬

## ì¶œì‹œ ë‹¹ì¼ ëª¨ë‹ˆí„°ë§
- ì‹¤ì‹œê°„ ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ (Sentry)
- ì„œë²„ ìƒíƒœ ëª¨ë‹ˆí„°ë§ (Fly.io Metrics)
- ì‚¬ìš©ì ìœ ì… ì¶”ì  (Firebase Analytics)
- ì•± ìŠ¤í† ì–´ ë¦¬ë·° ëª¨ë‹ˆí„°ë§

## ì¶œì‹œ í›„ 1ì£¼ì¼
- ë²„ê·¸ ê¸´ê¸‰ íŒ¨ì¹˜
- ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘ ë° ëŒ€ì‘
- ì²« ì£¼ í†µê³„ ë¶„ì„
  - ë‹¤ìš´ë¡œë“œ ìˆ˜
  - DAU/MAU
  - êµ¬ë… ì „í™˜ìœ¨
  - í‰ê·  ì„¸ì…˜ ì‹œê°„
```

---

## 6. Phase 4: ê³ ë„í™” (6ì£¼)

```markdown
# Phase 4: ê³ ë„í™” (2026-02-13 ~ 2026-03-26)

## Week 1-2: ê±´ê°• ë¦¬í¬íŠ¸ ìë™ ìƒì„±

### ëª©í‘œ
ì£¼ê°„/ì›”ê°„ ê±´ê°• ë¦¬í¬íŠ¸ë¥¼ AIê°€ ìë™ ìƒì„±

### ìš”êµ¬ì‚¬í•­
- core_api/services/report_service.py
- Claude APIë¡œ ë¦¬í¬íŠ¸ ìƒì„±
- ì›¨ì–´ëŸ¬ë¸” ë°ì´í„° + ìƒë‹´ ì´ë ¥ ë¶„ì„
- PDF ë˜ëŠ” ì´ë¯¸ì§€ë¡œ ìƒì„±
- ì´ë©”ì¼ ë˜ëŠ” ì•± í‘¸ì‹œë¡œ ì „ì†¡

---

## Week 3-4: ê±´ê°• ëª©í‘œ ì„¤ì • ë° ì¶”ì 

### ëª©í‘œ
ì‚¬ìš©ìê°€ ê±´ê°• ëª©í‘œë¥¼ ì„¤ì •í•˜ê³  ì§„í–‰ë¥  ì¶”ì 

### ì˜ˆì‹œ
- "í•œ ë‹¬ ë™ì•ˆ 5kg ê°ëŸ‰"
- "ë§¤ì¼ ë§Œë³´ ê±·ê¸°"
- "í˜ˆë‹¹ 120 ì´í•˜ ìœ ì§€"

### ìš”êµ¬ì‚¬í•­
- core_api/models/health_goal.py
- core_api/routers/goals.py
- Flutter UI: ëª©í‘œ ì„¤ì • í™”ë©´, ì§„í–‰ë¥  ì°¨íŠ¸

---

## Week 5-6: ê°€ì¡± ê³µìœ  ê¸°ëŠ¥ (ì„ íƒì )

### ëª©í‘œ
ê°€ì¡± êµ¬ì„±ì›ë¼ë¦¬ ê±´ê°• ë°ì´í„° ì„ íƒì  ê³µìœ 

### ìš”êµ¬ì‚¬í•­
- ê³µìœ  ì„¤ì • (ì–´ë–¤ ë°ì´í„°ë¥¼ ëˆ„êµ¬ì—ê²Œ)
- í‘¸ì‹œ ì•Œë¦¼ (ê°€ì¡±ì˜ ê±´ê°• ì´ìƒ ì‹œ)
- ê°€ì¡± ëŒ€ì‹œë³´ë“œ
```

---

## 7. Phase 5: í™•ì¥ (6ì£¼)

```markdown
# Phase 5: í™•ì¥ (2026-03-27 ~ 2026-05-07)

## Week 1-2: ìºë¦­í„° í™•ì¥ (6ëª… â†’ 20ëª…)

### ìƒˆë¡œìš´ ìºë¦­í„°
- ì¹˜ê³¼ ì „ë¬¸ì˜
- ì•ˆê³¼ ì „ë¬¸ì˜
- ì •í˜•ì™¸ê³¼ ì „ë¬¸ì˜
- ì¬í™œì˜í•™ê³¼ ì „ë¬¸ì˜
- í•œì˜ì‚¬
- ë“±ë“± 10ê°œ ì¶”ê°€

### ìš”êµ¬ì‚¬í•­
- AIìºë¦­í„° í”„ë¡¬í”„íŠ¸ ì‘ì„± (10ê°œ)
- conversation_service ì—…ë°ì´íŠ¸

---

## Week 3-4: ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥

### ëª©í‘œ
ì‚¬ìš©ì ê°„ ê±´ê°• ì •ë³´ ê³µìœ  ì»¤ë®¤ë‹ˆí‹°

### ìš”êµ¬ì‚¬í•­
- ê²Œì‹œíŒ (ì§ˆë¬¸, íŒ, ì„±ê³µ ì‚¬ë¡€)
- ëŒ“ê¸€, ì¢‹ì•„ìš”
- ì»¤ë®¤ë‹ˆí‹° ê°€ì´ë“œë¼ì¸ AI ê²€ìˆ˜

---

## Week 5-6: ë‹¤êµ­ì–´ ì§€ì›

### ëª©í‘œ
ê¸€ë¡œë²Œ í™•ì¥ì„ ìœ„í•œ ì˜ì–´, ì¼ë³¸ì–´ ì§€ì›

### ìš”êµ¬ì‚¬í•­
- ì•± UI ë‹¤êµ­ì–´í™” (Flutter intl)
- AI ìºë¦­í„° ì˜ì–´/ì¼ë³¸ì–´ í”„ë¡¬í”„íŠ¸
- ë²ˆì—­ API ì—°ë™ (DeepL ë˜ëŠ” Google Translate)
```

---

## 8. ë¶€ë¡: ìœ ìš©í•œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿

### ğŸ”§ ë¬¸ì œ í•´ê²° í”„ë¡¬í”„íŠ¸

```markdown
# ë¬¸ì œ ë°œìƒ ì‹œ

ë¬¸ì œê°€ ë°œìƒí–ˆì–´. ë‹¤ìŒì„ í™•ì¸í•´ì¤˜:

1. ì—ëŸ¬ ë©”ì‹œì§€ ì „ì²´ë¥¼ ë³´ì—¬ì¤˜
2. ì–´ë–¤ íŒŒì¼ì—ì„œ ë°œìƒí–ˆëŠ”ì§€ í™•ì¸í•´ì¤˜
3. TRD v1.2ì˜ ê´€ë ¨ ì„¹ì…˜ì„ ë‹¤ì‹œ ì½ê³  ìŠ¤í™ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•´ì¤˜
4. 3ê°€ì§€ í•´ê²° ë°©ë²•ì„ ì œì•ˆí•´ì¤˜ (ìš°ì„ ìˆœìœ„ ìˆœ)
5. ê°€ì¥ ì¢‹ì€ ë°©ë²•ì„ ì„ íƒí•˜ê³  êµ¬í˜„í•´ì¤˜
```

---

### ğŸ“Š ì§„í–‰ ìƒí™© í™•ì¸ í”„ë¡¬í”„íŠ¸

```markdown
# Day X-Y ì™„ë£Œ í™•ì¸

Day X-Y ì‘ì—…ì´ ì™„ë£Œëì–´?

ë‹¤ìŒì„ í™•ì¸í•´ì¤˜:
1. ê°œë°œ_ì²´í¬ë¦¬ìŠ¤íŠ¸_v1.2.mdì˜ Day X-Y ëª¨ë“  í•­ëª© ì™„ë£Œ ì—¬ë¶€
2. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼ ì—¬ë¶€
3. ë¡œì»¬ì—ì„œ ì‹¤í–‰ í…ŒìŠ¤íŠ¸ ê²°ê³¼
4. API ë¬¸ì„œ (Swagger UI) ì—…ë°ì´íŠ¸ ì—¬ë¶€

## ì™„ë£Œ ë³´ê³ ì„œ ì‘ì„±
- âœ… ì™„ë£Œëœ ì‘ì—… ëª©ë¡
- ğŸ“ ìƒì„±ëœ íŒŒì¼ ëª©ë¡
- ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½
- âš ï¸ ë°œê²¬ëœ ì´ìŠˆ (ìˆë‹¤ë©´)
- âœ¨ ë‹¤ìŒ ë‹¨ê³„ ì¤€ë¹„ì‚¬í•­
```

---

### ğŸ§ª í…ŒìŠ¤íŠ¸ í”„ë¡¬í”„íŠ¸

```markdown
# í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰

ë‹¤ìŒ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì „ë¶€ í…ŒìŠ¤íŠ¸í•´ì¤˜:

1. **ì‚¬ìš©ì í”Œë¡œìš°**
   - ì†Œì…œ ë¡œê·¸ì¸ (ì¹´ì¹´ì˜¤)
   - í”„ë¡œí•„ ìˆ˜ì •
   - ê±´ê°• ì •ë³´ ë“±ë¡

2. **ê°€ì¡± ê´€ë¦¬ í”Œë¡œìš°**
   - ê°€ì¡± í”„ë¡œí•„ ìƒì„± (ë¶€ëª¨ë‹˜)
   - ê°€ì¡± í”„ë¡œí•„ ì¡°íšŒ
   - ê±´ê°• ì •ë³´ ë“±ë¡

3. **ìŒì„± ìƒë‹´ í”Œë¡œìš°**
   - ìºë¦­í„° ì„ íƒ (ê¹€ì˜í›ˆ)
   - WebSocket ì—°ê²°
   - ìŒì„± ë©”ì‹œì§€ ì „ì†¡
   - ì‘ë‹µ ìˆ˜ì‹ 

4. **ë£¨í‹´ í”Œë¡œìš°**
   - ì˜¤ëŠ˜ì˜ ë£¨í‹´ ì²´í¬
   - ì €ì¥
   - í†µê³„ ì¡°íšŒ

ê° í…ŒìŠ¤íŠ¸ë§ˆë‹¤ ê²°ê³¼ë¥¼ ë³´ê³ í•´ì¤˜:
- âœ… ì„±ê³µ
- âŒ ì‹¤íŒ¨ (ì—ëŸ¬ ë©”ì‹œì§€ í¬í•¨)
```

---

### ğŸš€ ë°°í¬ í”„ë¡¬í”„íŠ¸

```markdown
# Fly.io ë°°í¬

ë‹¤ìŒ ìˆœì„œë¡œ Fly.io ë°°í¬ë¥¼ ì§„í–‰í•´ì¤˜:

1. **ì‚¬ì „ ì ê²€**
   - ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸
   - .env íŒŒì¼ í™•ì¸
   - fly.core.toml, fly.conversation.toml í™•ì¸

2. **ë°°í¬ ì‹¤í–‰**
   ```bash
   fly deploy --config fly.core.toml
   fly deploy --config fly.conversation.toml
   ```

3. **ë°°í¬ í›„ í™•ì¸**
   - fly status --app healthai-core-api
   - fly logs --app healthai-core-api
   - curl https://healthai-core-api.fly.dev/health

4. **ë§ˆì´ê·¸ë ˆì´ì…˜**
   ```bash
   fly ssh console --app healthai-core-api
   alembic upgrade head
   ```

5. **Smoke Test**
   - /health ì—”ë“œí¬ì¸íŠ¸
   - POST /api/v1/auth/login/social (í…ŒìŠ¤íŠ¸ í† í°)
   - GET /api/v1/users/me

ê° ë‹¨ê³„ë§ˆë‹¤ ê²°ê³¼ë¥¼ ë³´ê³ í•´ì¤˜.
```

---

### ğŸ“ ì½”ë“œ ë¦¬ë·° í”„ë¡¬í”„íŠ¸

```markdown
# ì½”ë“œ ë¦¬ë·° ìš”ì²­

ë°©ê¸ˆ ì‘ì„±í•œ ì½”ë“œë¥¼ ë¦¬ë·°í•´ì¤˜:

## ì²´í¬ë¦¬ìŠ¤íŠ¸
1. **TRD ìŠ¤í™ ì¤€ìˆ˜**
   - TRD v1.2ì™€ 100% ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸

2. **ì½”ë“œ í’ˆì§ˆ**
   - PEP 8 (Python) ì¤€ìˆ˜
   - íƒ€ì… íŒíŠ¸ ì‚¬ìš©
   - Docstring ì‘ì„±

3. **ë³´ì•ˆ**
   - SQL Injection ë°©ì§€ (ORM ì‚¬ìš©)
   - JWT í† í° ê²€ì¦
   - ë¯¼ê° ì •ë³´ ë…¸ì¶œ ë°©ì§€

4. **ì„±ëŠ¥**
   - N+1 ì¿¼ë¦¬ ë¬¸ì œ
   - ë¶ˆí•„ìš”í•œ DB í˜¸ì¶œ
   - ìºì‹± ê°€ëŠ¥ ì—¬ë¶€

5. **í…ŒìŠ¤íŠ¸**
   - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
   - Edge case ì²˜ë¦¬

ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„ì´ ìˆë‹¤ë©´ êµ¬ì²´ì ìœ¼ë¡œ ì œì•ˆí•´ì¤˜.
```

---

### ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ ì¤€ë¹„ í”„ë¡¬í”„íŠ¸

```markdown
# ë‹¤ìŒ ë‹¨ê³„ ì¤€ë¹„

Day X-Yê°€ ì™„ë£Œëìœ¼ë‹ˆ Day Zë¡œ ë„˜ì–´ê°ˆ ì¤€ë¹„ë¥¼ í•˜ì.

1. **í˜„ì¬ ìƒíƒœ ì •ë¦¬**
   - ì™„ë£Œëœ ê¸°ëŠ¥ ëª©ë¡
   - API ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡
   - í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€

2. **ë‹¤ìŒ ë‹¨ê³„ í™•ì¸**
   - ê°œë°œ_ì²´í¬ë¦¬ìŠ¤íŠ¸_v1.2.mdì˜ Day Z ì½ê¸°
   - í•„ìš”í•œ íŒŒì¼ ëª©ë¡
   - ì°¸ì¡°í•´ì•¼ í•  TRD ì„¹ì…˜

3. **ì¤€ë¹„ ì‚¬í•­**
   - ìƒˆë¡œìš´ íŒ¨í‚¤ì§€ ì„¤ì¹˜ í•„ìš” ì—¬ë¶€
   - DB ìŠ¤í‚¤ë§ˆ ë³€ê²½ í•„ìš” ì—¬ë¶€
   - ì™¸ë¶€ API ì—°ë™ í•„ìš” ì—¬ë¶€

4. **ì‹œì‘ ì„ ì–¸**
   - "Day Z ì‹œì‘ ì¤€ë¹„ ì™„ë£Œ!"
```

---

## ğŸ‰ ë§ˆë¬´ë¦¬

ì´ í”„ë¡¬í”„íŠ¸ ê°€ì´ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ Claude Codeì™€ í•¨ê»˜ **ìŒì„± AI ê±´ê°•ì£¼ì¹˜ì˜ ì•±**ì„ ë‹¨ê³„ë³„ë¡œ ê°œë°œí•˜ì„¸ìš”!

### í•µì‹¬ ì›ì¹™
1. **ë¬¸ì„œ ìš°ì„ **: í•­ìƒ PRD, TRD, ì²´í¬ë¦¬ìŠ¤íŠ¸ ì°¸ì¡°
2. **í•œ ë²ˆì— í•œ Day**: ìš•ì‹¬ë‚´ì§€ ë§ê³  ìˆœì„œëŒ€ë¡œ
3. **í…ŒìŠ¤íŠ¸ í•„ìˆ˜**: ì½”ë“œ ì‘ì„± í›„ ë°˜ë“œì‹œ í…ŒìŠ¤íŠ¸
4. **í”¼ë“œë°± ë£¨í”„**: ì™„ë£Œ â†’ í™•ì¸ â†’ ë‹¤ìŒ ë‹¨ê³„

### ì˜ˆìƒ íƒ€ì„ë¼ì¸
- **Phase 1 (MVP)**: 8ì£¼ (56ì¼)
- **Phase 1.5 (ë£¨í‹´)**: 1ì£¼ (5ì¼)
- **Phase 2 (ë² íƒ€)**: 2ì£¼
- **Phase 3 (ì¶œì‹œ)**: 2026-02-12
- **Phase 4 (ê³ ë„í™”)**: 6ì£¼
- **Phase 5 (í™•ì¥)**: 6ì£¼

### ì„±ê³µ ì§€í‘œ
- âœ… MVP ì™„ì„±: 2026-01-20
- âœ… ë² íƒ€ í…ŒìŠ¤íŠ¸: 100ëª…
- âœ… ì •ì‹ ì¶œì‹œ: 2026-02-12
- âœ… 6ê°œì›” í›„ MAU: 10,000ëª…

---

**í–‰ìš´ì„ ë¹•ë‹ˆë‹¤! ğŸš€**
