# Day 29-42: ì›¨ì–´ëŸ¬ë¸” ì—°ë™ & ê±´ê°• ë°ì´í„° ì™„ì „ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ì´ ì„¹ì…˜ì€ Claude Code ê°œë°œ í”„ë¡¬í”„íŠ¸ v1.3ì˜ **Day 29-42: ì›¨ì–´ëŸ¬ë¸” ì—°ë™ & ê±´ê°• ë°ì´í„° ìˆ˜ì§‘** ë¶€ë¶„ì…ë‹ˆë‹¤.

**ì°¸ì¡° ë¬¸ì„œ:**
- ê°œë°œ_ì²´í¬ë¦¬ìŠ¤íŠ¸_v1.3.md: Day 29-42 (Lines 313-364)
- TRD v1.3: ì„¹ì…˜ 4.4 (Health Data í…Œì´ë¸”)
- TRD v1.3: ì„¹ì…˜ 4.5 (Wearable Data í…Œì´ë¸”)
- PRD v1.3: ì„¹ì…˜ 4.3 (ì›¨ì–´ëŸ¬ë¸” ì—°ë™ ê¸°ëŠ¥)

---

## Day 29-31: ê±´ê°• ë°ì´í„° ìˆ˜ì§‘ API

### ëª©í‘œ
ê°€ì¡± í”„ë¡œí•„ë³„ ê±´ê°• ì •ë³´(í˜ˆì••, í˜ˆë‹¹, ì²´ì¤‘ ë“±)ë¥¼ ìˆ˜ì§‘í•˜ëŠ” APIë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

### Claude Code í”„ë¡¬í”„íŠ¸

```markdown
# Day 29-31: ê±´ê°• ë°ì´í„° ìˆ˜ì§‘ API

## ëª©í‘œ
ê°€ì¡± í”„ë¡œí•„ë³„ë¡œ ê±´ê°• ì •ë³´(í˜ˆì••, í˜ˆë‹¹, ì²´ì¤‘ ë“±)ë¥¼ ìˆ˜ë™ ì…ë ¥í•  ìˆ˜ ìˆëŠ” APIë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

## 1. core_api/models/health_data.py ì‘ì„±

TRD v1.3 ì„¹ì…˜ 4.4 ì°¸ì¡°:

```python
from sqlalchemy import Column, String, DateTime, ForeignKey, Float, Enum as SQLEnum, Text
from sqlalchemy.orm import relationship
from datetime import datetime
import uuid
import enum
from core_api.database import Base

class HealthDataType(str, enum.Enum):
    BLOOD_PRESSURE = "blood_pressure"      # í˜ˆì••
    BLOOD_SUGAR = "blood_sugar"            # í˜ˆë‹¹
    WEIGHT = "weight"                      # ì²´ì¤‘
    BODY_FAT = "body_fat"                  # ì²´ì§€ë°©ë¥ 
    TEMPERATURE = "temperature"             # ì²´ì˜¨
    HEART_RATE = "heart_rate"              # ì‹¬ë°•ìˆ˜
    SPO2 = "spo2"                          # ì‚°ì†Œí¬í™”ë„
    MEDICATION = "medication"               # ë³µì•½ ê¸°ë¡
    SYMPTOM = "symptom"                    # ì¦ìƒ ê¸°ë¡
    MEMO = "memo"                          # ë©”ëª¨

class HealthData(Base):
    __tablename__ = "health_data"
    
    # Primary Key
    id = Column(String(36), primary_key=True, default=lambda: str(uuid.uuid4()))
    
    # Foreign Key
    family_profile_id = Column(String(36), ForeignKey("family_profiles.id", ondelete="CASCADE"), nullable=False)
    
    # Data Type
    data_type = Column(SQLEnum(HealthDataType), nullable=False)
    
    # Values
    value = Column(Float, nullable=True)  # ìˆ˜ì¹˜í˜• ë°ì´í„° (í˜ˆì••, í˜ˆë‹¹, ì²´ì¤‘ ë“±)
    value_text = Column(Text, nullable=True)  # í…ìŠ¤íŠ¸ ë°ì´í„° (ì¦ìƒ, ë©”ëª¨ ë“±)
    
    # Additional Fields
    systolic = Column(Float, nullable=True)   # ìˆ˜ì¶•ê¸° í˜ˆì••
    diastolic = Column(Float, nullable=True)  # ì´ì™„ê¸° í˜ˆì••
    
    unit = Column(String(20), nullable=True)  # ë‹¨ìœ„ (kg, mg/dL, mmHg, etc.)
    
    # Metadata
    measured_at = Column(DateTime, nullable=False, default=datetime.utcnow)  # ì¸¡ì • ì‹œê°„
    source = Column(String(50), nullable=True)  # "manual", "wearable", "hospital"
    
    # Timestamps
    created_at = Column(DateTime, default=datetime.utcnow, nullable=False)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow, nullable=False)
    
    # Relationships
    family_profile = relationship("FamilyProfile", back_populates="health_data")
    
    def __repr__(self):
        return f"<HealthData(id={self.id}, type={self.data_type}, value={self.value})>"
```

## 2. ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ë° ì‹¤í–‰

```bash
# ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
docker-compose exec core_api alembic revision --autogenerate -m "Add health_data table"

# ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
docker-compose exec core_api alembic upgrade head
```

## 3. core_api/schemas/health_data.py ì‘ì„±

```python
from pydantic import BaseModel, Field, validator
from typing import Optional
from datetime import datetime

class HealthDataCreate(BaseModel):
    family_profile_id: str
    data_type: str  # "blood_pressure", "blood_sugar", "weight", etc.
    
    # ìˆ˜ì¹˜í˜• ë°ì´í„°
    value: Optional[float] = None
    value_text: Optional[str] = None
    
    # í˜ˆì•• ì¶”ê°€ í•„ë“œ
    systolic: Optional[float] = None
    diastolic: Optional[float] = None
    
    unit: Optional[str] = None
    measured_at: Optional[datetime] = None
    source: str = "manual"
    
    @validator('data_type')
    def validate_data_type(cls, v):
        valid_types = [
            'blood_pressure', 'blood_sugar', 'weight', 'body_fat',
            'temperature', 'heart_rate', 'spo2', 'medication', 'symptom', 'memo'
        ]
        if v not in valid_types:
            raise ValueError(f'Invalid data_type. Must be one of: {valid_types}')
        return v
    
    @validator('measured_at', pre=True, always=True)
    def set_measured_at(cls, v):
        return v or datetime.utcnow()
    
    class Config:
        json_schema_extra = {
            "example": {
                "family_profile_id": "uuid-here",
                "data_type": "blood_pressure",
                "systolic": 130,
                "diastolic": 85,
                "unit": "mmHg",
                "measured_at": "2025-12-07T09:00:00Z",
                "source": "manual"
            }
        }

class HealthDataUpdate(BaseModel):
    value: Optional[float] = None
    value_text: Optional[str] = None
    systolic: Optional[float] = None
    diastolic: Optional[float] = None
    unit: Optional[str] = None
    measured_at: Optional[datetime] = None

class HealthDataResponse(BaseModel):
    id: str
    family_profile_id: str
    data_type: str
    value: Optional[float] = None
    value_text: Optional[str] = None
    systolic: Optional[float] = None
    diastolic: Optional[float] = None
    unit: Optional[str] = None
    measured_at: datetime
    source: str
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True
```

## 4. core_api/services/health_data_service.py ì‘ì„±

```python
from sqlalchemy.orm import Session
from core_api.models.health_data import HealthData, HealthDataType
from core_api.models.family import FamilyProfile
from core_api.models.user import User
from core_api.schemas.health_data import HealthDataCreate, HealthDataUpdate
from typing import List, Optional
from datetime import datetime, timedelta
from fastapi import HTTPException, status

class HealthDataService:
    """ê±´ê°• ë°ì´í„° ì„œë¹„ìŠ¤"""
    
    @staticmethod
    def verify_profile_ownership(
        db: Session,
        user: User,
        family_profile_id: str
    ) -> FamilyProfile:
        """ê°€ì¡± í”„ë¡œí•„ì´ í˜„ì¬ ì‚¬ìš©ì ì†Œìœ ì¸ì§€ í™•ì¸"""
        profile = db.query(FamilyProfile).filter(
            FamilyProfile.id == family_profile_id,
            FamilyProfile.user_id == user.id
        ).first()
        
        if not profile:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="Family profile not found or access denied"
            )
        
        return profile
    
    @staticmethod
    def create_health_data(
        db: Session,
        user: User,
        data: HealthDataCreate
    ) -> HealthData:
        """ê±´ê°• ë°ì´í„° ìƒì„±"""
        # í”„ë¡œí•„ ì†Œìœ ê¶Œ í™•ì¸
        HealthDataService.verify_profile_ownership(db, user, data.family_profile_id)
        
        new_data = HealthData(
            family_profile_id=data.family_profile_id,
            data_type=HealthDataType(data.data_type),
            value=data.value,
            value_text=data.value_text,
            systolic=data.systolic,
            diastolic=data.diastolic,
            unit=data.unit,
            measured_at=data.measured_at,
            source=data.source
        )
        
        db.add(new_data)
        db.commit()
        db.refresh(new_data)
        
        return new_data
    
    @staticmethod
    def get_health_data(
        db: Session,
        user: User,
        family_profile_id: str,
        data_type: Optional[str] = None,
        days: int = 30
    ) -> List[HealthData]:
        """ê±´ê°• ë°ì´í„° ì¡°íšŒ (ìµœê·¼ Nì¼)"""
        # í”„ë¡œí•„ ì†Œìœ ê¶Œ í™•ì¸
        HealthDataService.verify_profile_ownership(db, user, family_profile_id)
        
        # ê¸°ê°„ í•„í„°
        start_date = datetime.utcnow() - timedelta(days=days)
        
        query = db.query(HealthData).filter(
            HealthData.family_profile_id == family_profile_id,
            HealthData.measured_at >= start_date
        )
        
        # ë°ì´í„° íƒ€ì… í•„í„°
        if data_type:
            query = query.filter(HealthData.data_type == HealthDataType(data_type))
        
        # ìµœì‹ ìˆœ ì •ë ¬
        return query.order_by(HealthData.measured_at.desc()).all()
    
    @staticmethod
    def update_health_data(
        db: Session,
        user: User,
        data_id: str,
        update_data: HealthDataUpdate
    ) -> HealthData:
        """ê±´ê°• ë°ì´í„° ìˆ˜ì •"""
        data = db.query(HealthData).filter(HealthData.id == data_id).first()
        
        if not data:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="Health data not found"
            )
        
        # í”„ë¡œí•„ ì†Œìœ ê¶Œ í™•ì¸
        HealthDataService.verify_profile_ownership(db, user, data.family_profile_id)
        
        # ì—…ë°ì´íŠ¸
        update_dict = update_data.dict(exclude_unset=True)
        for key, value in update_dict.items():
            setattr(data, key, value)
        
        db.commit()
        db.refresh(data)
        
        return data
    
    @staticmethod
    def delete_health_data(
        db: Session,
        user: User,
        data_id: str
    ) -> None:
        """ê±´ê°• ë°ì´í„° ì‚­ì œ"""
        data = db.query(HealthData).filter(HealthData.id == data_id).first()
        
        if not data:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="Health data not found"
            )
        
        # í”„ë¡œí•„ ì†Œìœ ê¶Œ í™•ì¸
        HealthDataService.verify_profile_ownership(db, user, data.family_profile_id)
        
        db.delete(data)
        db.commit()
```

## 5. core_api/routers/health_data.py ì‘ì„±

```python
from fastapi import APIRouter, Depends, HTTPException, status, Query
from sqlalchemy.orm import Session
from core_api.database import get_db
from core_api.schemas.health_data import (
    HealthDataCreate,
    HealthDataUpdate,
    HealthDataResponse
)
from core_api.services.health_data_service import HealthDataService
from core_api.dependencies import get_current_active_user
from core_api.models.user import User
from typing import List, Optional

router = APIRouter(prefix="/api/v1/health", tags=["Health Data"])

@router.post("", response_model=HealthDataResponse, status_code=status.HTTP_201_CREATED)
async def create_health_data(
    data: HealthDataCreate,
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """
    ê±´ê°• ë°ì´í„° ìƒì„± (ìˆ˜ë™ ì…ë ¥)
    
    - í˜ˆì••: systolic, diastolic í•„ë“œ ì‚¬ìš©
    - í˜ˆë‹¹, ì²´ì¤‘, ì²´ì˜¨ ë“±: value í•„ë“œ ì‚¬ìš©
    - ì¦ìƒ, ë©”ëª¨: value_text í•„ë“œ ì‚¬ìš©
    """
    new_data = HealthDataService.create_health_data(db, current_user, data)
    return HealthDataResponse.from_orm(new_data)

@router.get("/profiles/{family_profile_id}", response_model=List[HealthDataResponse])
async def get_health_data_by_profile(
    family_profile_id: str,
    data_type: Optional[str] = Query(None, description="blood_pressure, blood_sugar, weight, etc."),
    days: int = Query(30, ge=1, le=365, description="ìµœê·¼ Nì¼"),
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """
    íŠ¹ì • ê°€ì¡± í”„ë¡œí•„ì˜ ê±´ê°• ë°ì´í„° ì¡°íšŒ
    
    - data_type: í•„í„° (ì„ íƒ)
    - days: ìµœê·¼ Nì¼ (ê¸°ë³¸ 30ì¼)
    """
    data_list = HealthDataService.get_health_data(
        db, current_user, family_profile_id, data_type, days
    )
    return [HealthDataResponse.from_orm(d) for d in data_list]

@router.patch("/{data_id}", response_model=HealthDataResponse)
async def update_health_data(
    data_id: str,
    update_data: HealthDataUpdate,
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """ê±´ê°• ë°ì´í„° ìˆ˜ì •"""
    updated_data = HealthDataService.update_health_data(db, current_user, data_id, update_data)
    return HealthDataResponse.from_orm(updated_data)

@router.delete("/{data_id}", status_code=status.HTTP_204_NO_CONTENT)
async def delete_health_data(
    data_id: str,
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """ê±´ê°• ë°ì´í„° ì‚­ì œ"""
    HealthDataService.delete_health_data(db, current_user, data_id)
    return None
```

## 6. core_api/main.py ë¼ìš°í„° ë“±ë¡

```python
from core_api.routers import auth, users, families, characters, health_data  # ì¶”ê°€

app.include_router(health_data.router)  # ì¶”ê°€
```

## ì™„ë£Œ ê¸°ì¤€
- [ ] core_api/models/health_data.py ì‘ì„±
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ë° ì‹¤í–‰
- [ ] core_api/schemas/health_data.py ì‘ì„±
- [ ] core_api/services/health_data_service.py ì‘ì„±
- [ ] core_api/routers/health_data.py ì‘ì„±
  - [ ] POST /api/v1/health (ìƒì„±)
  - [ ] GET /api/v1/health/profiles/{id} (ì¡°íšŒ)
  - [ ] PATCH /api/v1/health/{id} (ìˆ˜ì •)
  - [ ] DELETE /api/v1/health/{id} (ì‚­ì œ)
- [ ] API ë¬¸ì„œ í™•ì¸
- [ ] í…ŒìŠ¤íŠ¸ ì‹¤í–‰

## í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´
```bash
# í˜ˆì•• ë°ì´í„° ìƒì„±
curl -X POST http://localhost:8000/api/v1/health \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "family_profile_id": "your-profile-id",
    "data_type": "blood_pressure",
    "systolic": 130,
    "diastolic": 85,
    "unit": "mmHg",
    "source": "manual"
  }'

# í˜ˆë‹¹ ë°ì´í„° ìƒì„±
curl -X POST http://localhost:8000/api/v1/health \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "family_profile_id": "your-profile-id",
    "data_type": "blood_sugar",
    "value": 110,
    "unit": "mg/dL",
    "source": "manual"
  }'

# í”„ë¡œí•„ë³„ ê±´ê°• ë°ì´í„° ì¡°íšŒ (ìµœê·¼ 30ì¼)
curl -X GET "http://localhost:8000/api/v1/health/profiles/{profile_id}?days=30" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"

# íŠ¹ì • íƒ€ì…ë§Œ ì¡°íšŒ
curl -X GET "http://localhost:8000/api/v1/health/profiles/{profile_id}?data_type=blood_pressure&days=7" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

## ë³´ê³ ì„œ ì‘ì„±
Day 29-31 ì™„ë£Œ í›„ ë‹¤ìŒì„ ë³´ê³ í•´ì¤˜:
1. ì‘ì„±ëœ íŒŒì¼ ëª©ë¡
2. API ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡
3. í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ê²°ê³¼
4. ë‹¤ìŒ ë‹¨ê³„ ì¤€ë¹„ ìƒíƒœ

ì™„ë£Œí–ˆìœ¼ë©´ "Day 29-31 ì™„ë£Œ ë³´ê³ ì„œ"ë¥¼ ì‘ì„±í•´ì¤˜.
```

---

## Day 32-35: ì›¨ì–´ëŸ¬ë¸” ë°ì´í„° ë™ê¸°í™”

### ëª©í‘œ
Apple HealthKit ë° Android Health Connectì—ì„œ ì›¨ì–´ëŸ¬ë¸” ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” APIë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

### Claude Code í”„ë¡¬í”„íŠ¸

```markdown
# Day 32-35: ì›¨ì–´ëŸ¬ë¸” ë°ì´í„° ë™ê¸°í™”

## ëª©í‘œ
Apple Watch, Galaxy Watch ë“± ì›¨ì–´ëŸ¬ë¸” ê¸°ê¸°ì˜ ê±´ê°• ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” APIë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

## 1. core_api/models/wearable_data.py ì‘ì„±

TRD v1.3 ì„¹ì…˜ 4.5 ì°¸ì¡°:

```python
from sqlalchemy import Column, String, DateTime, ForeignKey, Float, Integer, Enum as SQLEnum
from sqlalchemy.orm import relationship
from datetime import datetime
import uuid
import enum
from core_api.database import Base

class WearableDataType(str, enum.Enum):
    STEPS = "steps"                      # ê±¸ìŒìˆ˜
    HEART_RATE = "heart_rate"            # ì‹¬ë°•ìˆ˜
    SLEEP = "sleep"                      # ìˆ˜ë©´
    CALORIES = "calories"                # ì¹¼ë¡œë¦¬ ì†Œëª¨
    DISTANCE = "distance"                # ì´ë™ ê±°ë¦¬
    EXERCISE = "exercise"                # ìš´ë™
    BLOOD_OXYGEN = "blood_oxygen"        # í˜ˆì¤‘ ì‚°ì†Œ
    STRESS = "stress"                    # ìŠ¤íŠ¸ë ˆìŠ¤

class WearableData(Base):
    __tablename__ = "wearable_data"
    
    # Primary Key
    id = Column(String(36), primary_key=True, default=lambda: str(uuid.uuid4()))
    
    # Foreign Key
    family_profile_id = Column(String(36), ForeignKey("family_profiles.id", ondelete="CASCADE"), nullable=False)
    
    # Data Type
    data_type = Column(SQLEnum(WearableDataType), nullable=False)
    
    # Values
    value = Column(Float, nullable=False)
    unit = Column(String(20), nullable=True)  # "steps", "bpm", "minutes", "kcal", "km"
    
    # Time Range (for aggregated data like sleep)
    start_time = Column(DateTime, nullable=False)
    end_time = Column(DateTime, nullable=True)
    
    # Metadata
    source = Column(String(50), nullable=False)  # "apple_health", "health_connect", "galaxy_watch"
    device_id = Column(String(100), nullable=True)
    
    # Timestamps
    created_at = Column(DateTime, default=datetime.utcnow, nullable=False)
    
    # Relationships
    family_profile = relationship("FamilyProfile")
    
    # Unique constraint: ì¤‘ë³µ ë°ì´í„° ë°©ì§€
    # (family_profile_id, data_type, start_time, source) ì¡°í•©ìœ¼ë¡œ ì¤‘ë³µ ì²´í¬
    
    def __repr__(self):
        return f"<WearableData(id={self.id}, type={self.data_type}, value={self.value})>"
```

## 2. ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ë° ì‹¤í–‰

```bash
# ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
docker-compose exec core_api alembic revision --autogenerate -m "Add wearable_data table"

# ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
docker-compose exec core_api alembic upgrade head

# Unique constraint ì¶”ê°€ (ì„ íƒ)
# alembic revision -m "Add unique constraint to wearable_data"
# ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ í¸ì§‘:
# op.create_unique_constraint(
#     'uq_wearable_data_profile_type_time_source',
#     'wearable_data',
#     ['family_profile_id', 'data_type', 'start_time', 'source']
# )
```

## 3. core_api/schemas/wearable_data.py ì‘ì„±

```python
from pydantic import BaseModel, Field, validator
from typing import Optional, List
from datetime import datetime

class WearableDataPoint(BaseModel):
    """ë‹¨ì¼ ì›¨ì–´ëŸ¬ë¸” ë°ì´í„° í¬ì¸íŠ¸"""
    data_type: str  # "steps", "heart_rate", etc.
    value: float
    unit: Optional[str] = None
    start_time: datetime
    end_time: Optional[datetime] = None
    source: str = "apple_health"
    device_id: Optional[str] = None

class WearableDataBatch(BaseModel):
    """ë°°ì¹˜ ì—…ë¡œë“œ (ìµœëŒ€ 100ê°œ)"""
    family_profile_id: str
    data_points: List[WearableDataPoint] = Field(..., max_items=100)
    
    @validator('data_points')
    def validate_data_points(cls, v):
        if len(v) == 0:
            raise ValueError('At least one data point required')
        if len(v) > 100:
            raise ValueError('Maximum 100 data points per batch')
        return v
    
    class Config:
        json_schema_extra = {
            "example": {
                "family_profile_id": "uuid-here",
                "data_points": [
                    {
                        "data_type": "steps",
                        "value": 8532,
                        "unit": "steps",
                        "start_time": "2025-12-07T00:00:00Z",
                        "end_time": "2025-12-07T23:59:59Z",
                        "source": "apple_health"
                    },
                    {
                        "data_type": "heart_rate",
                        "value": 72,
                        "unit": "bpm",
                        "start_time": "2025-12-07T09:00:00Z",
                        "source": "apple_health"
                    }
                ]
            }
        }

class WearableDataResponse(BaseModel):
    id: str
    family_profile_id: str
    data_type: str
    value: float
    unit: Optional[str] = None
    start_time: datetime
    end_time: Optional[datetime] = None
    source: str
    device_id: Optional[str] = None
    created_at: datetime
    
    class Config:
        from_attributes = True

class WearableDataStats(BaseModel):
    """ì¼ì¼/ì£¼ê°„ í†µê³„"""
    data_type: str
    total: float
    average: float
    min: float
    max: float
    count: int
    unit: Optional[str] = None
```

## 4. core_api/services/wearable_service.py ì‘ì„±

```python
from sqlalchemy.orm import Session
from core_api.models.wearable_data import WearableData, WearableDataType
from core_api.models.family import FamilyProfile
from core_api.models.user import User
from core_api.schemas.wearable_data import WearableDataBatch, WearableDataStats
from typing import List, Optional
from datetime import datetime, timedelta
from fastapi import HTTPException, status
from sqlalchemy import func

class WearableService:
    """ì›¨ì–´ëŸ¬ë¸” ë°ì´í„° ì„œë¹„ìŠ¤"""
    
    @staticmethod
    def verify_profile_ownership(
        db: Session,
        user: User,
        family_profile_id: str
    ) -> FamilyProfile:
        """ê°€ì¡± í”„ë¡œí•„ì´ í˜„ì¬ ì‚¬ìš©ì ì†Œìœ ì¸ì§€ í™•ì¸"""
        profile = db.query(FamilyProfile).filter(
            FamilyProfile.id == family_profile_id,
            FamilyProfile.user_id == user.id
        ).first()
        
        if not profile:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="Family profile not found or access denied"
            )
        
        return profile
    
    @staticmethod
    def sync_wearable_data(
        db: Session,
        user: User,
        batch: WearableDataBatch
    ) -> dict:
        """ì›¨ì–´ëŸ¬ë¸” ë°ì´í„° ë°°ì¹˜ ë™ê¸°í™”"""
        # í”„ë¡œí•„ ì†Œìœ ê¶Œ í™•ì¸
        WearableService.verify_profile_ownership(db, user, batch.family_profile_id)
        
        created_count = 0
        duplicate_count = 0
        
        for data_point in batch.data_points:
            # ì¤‘ë³µ ì²´í¬
            existing = db.query(WearableData).filter(
                WearableData.family_profile_id == batch.family_profile_id,
                WearableData.data_type == WearableDataType(data_point.data_type),
                WearableData.start_time == data_point.start_time,
                WearableData.source == data_point.source
            ).first()
            
            if existing:
                duplicate_count += 1
                continue
            
            # ìƒˆ ë°ì´í„° ìƒì„±
            new_data = WearableData(
                family_profile_id=batch.family_profile_id,
                data_type=WearableDataType(data_point.data_type),
                value=data_point.value,
                unit=data_point.unit,
                start_time=data_point.start_time,
                end_time=data_point.end_time,
                source=data_point.source,
                device_id=data_point.device_id
            )
            
            db.add(new_data)
            created_count += 1
        
        db.commit()
        
        return {
            "created": created_count,
            "duplicates": duplicate_count,
            "total": len(batch.data_points)
        }
    
    @staticmethod
    def get_wearable_data(
        db: Session,
        user: User,
        family_profile_id: str,
        data_type: Optional[str] = None,
        days: int = 7
    ) -> List[WearableData]:
        """ì›¨ì–´ëŸ¬ë¸” ë°ì´í„° ì¡°íšŒ"""
        # í”„ë¡œí•„ ì†Œìœ ê¶Œ í™•ì¸
        WearableService.verify_profile_ownership(db, user, family_profile_id)
        
        # ê¸°ê°„ í•„í„°
        start_date = datetime.utcnow() - timedelta(days=days)
        
        query = db.query(WearableData).filter(
            WearableData.family_profile_id == family_profile_id,
            WearableData.start_time >= start_date
        )
        
        # ë°ì´í„° íƒ€ì… í•„í„°
        if data_type:
            query = query.filter(WearableData.data_type == WearableDataType(data_type))
        
        return query.order_by(WearableData.start_time.desc()).all()
    
    @staticmethod
    def get_daily_stats(
        db: Session,
        user: User,
        family_profile_id: str,
        data_type: str,
        date: datetime
    ) -> WearableDataStats:
        """ì¼ì¼ í†µê³„"""
        # í”„ë¡œí•„ ì†Œìœ ê¶Œ í™•ì¸
        WearableService.verify_profile_ownership(db, user, family_profile_id)
        
        # í•´ë‹¹ ë‚ ì§œ ë°ì´í„° ì¡°íšŒ
        start_of_day = date.replace(hour=0, minute=0, second=0, microsecond=0)
        end_of_day = start_of_day + timedelta(days=1)
        
        stats = db.query(
            func.sum(WearableData.value).label('total'),
            func.avg(WearableData.value).label('average'),
            func.min(WearableData.value).label('min'),
            func.max(WearableData.value).label('max'),
            func.count(WearableData.id).label('count')
        ).filter(
            WearableData.family_profile_id == family_profile_id,
            WearableData.data_type == WearableDataType(data_type),
            WearableData.start_time >= start_of_day,
            WearableData.start_time < end_of_day
        ).first()
        
        if stats.count == 0:
            return WearableDataStats(
                data_type=data_type,
                total=0,
                average=0,
                min=0,
                max=0,
                count=0
            )
        
        return WearableDataStats(
            data_type=data_type,
            total=stats.total or 0,
            average=stats.average or 0,
            min=stats.min or 0,
            max=stats.max or 0,
            count=stats.count or 0
        )
```

## 5. core_api/routers/wearables.py ì‘ì„±

```python
from fastapi import APIRouter, Depends, HTTPException, status, Query
from sqlalchemy.orm import Session
from core_api.database import get_db
from core_api.schemas.wearable_data import (
    WearableDataBatch,
    WearableDataResponse,
    WearableDataStats
)
from core_api.services.wearable_service import WearableService
from core_api.dependencies import get_current_active_user
from core_api.models.user import User
from typing import List, Optional
from datetime import datetime

router = APIRouter(prefix="/api/v1/wearables", tags=["Wearable Data"])

@router.post("/sync", response_model=dict)
async def sync_wearable_data(
    batch: WearableDataBatch,
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """
    ì›¨ì–´ëŸ¬ë¸” ë°ì´í„° ë°°ì¹˜ ë™ê¸°í™”
    
    - ìµœëŒ€ 100ê°œ ë°ì´í„° í¬ì¸íŠ¸
    - ì¤‘ë³µ ë°ì´í„° ìë™ ì œê±°
    - Apple HealthKit, Android Health Connect ì§€ì›
    """
    result = WearableService.sync_wearable_data(db, current_user, batch)
    return result

@router.get("/profiles/{family_profile_id}", response_model=List[WearableDataResponse])
async def get_wearable_data(
    family_profile_id: str,
    data_type: Optional[str] = Query(None, description="steps, heart_rate, sleep, etc."),
    days: int = Query(7, ge=1, le=90, description="ìµœê·¼ Nì¼"),
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """
    íŠ¹ì • ê°€ì¡± í”„ë¡œí•„ì˜ ì›¨ì–´ëŸ¬ë¸” ë°ì´í„° ì¡°íšŒ
    
    - data_type: í•„í„° (ì„ íƒ)
    - days: ìµœê·¼ Nì¼ (ê¸°ë³¸ 7ì¼)
    """
    data_list = WearableService.get_wearable_data(
        db, current_user, family_profile_id, data_type, days
    )
    return [WearableDataResponse.from_orm(d) for d in data_list]

@router.get("/profiles/{family_profile_id}/stats/daily", response_model=WearableDataStats)
async def get_daily_stats(
    family_profile_id: str,
    data_type: str = Query(..., description="steps, heart_rate, etc."),
    date: datetime = Query(..., description="YYYY-MM-DD"),
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """
    ì¼ì¼ í†µê³„ ì¡°íšŒ
    
    - data_type: ë°ì´í„° íƒ€ì… (í•„ìˆ˜)
    - date: ë‚ ì§œ (í•„ìˆ˜)
    """
    stats = WearableService.get_daily_stats(
        db, current_user, family_profile_id, data_type, date
    )
    return stats
```

## 6. core_api/main.py ë¼ìš°í„° ë“±ë¡

```python
from core_api.routers import auth, users, families, characters, health_data, wearables  # ì¶”ê°€

app.include_router(wearables.router)  # ì¶”ê°€
```

## ì™„ë£Œ ê¸°ì¤€
- [ ] core_api/models/wearable_data.py ì‘ì„±
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ë° ì‹¤í–‰
- [ ] core_api/schemas/wearable_data.py ì‘ì„±
- [ ] core_api/services/wearable_service.py ì‘ì„±
- [ ] core_api/routers/wearables.py ì‘ì„±
  - [ ] POST /api/v1/wearables/sync (ë°°ì¹˜ ë™ê¸°í™”)
  - [ ] GET /api/v1/wearables/profiles/{id} (ì¡°íšŒ)
  - [ ] GET /api/v1/wearables/profiles/{id}/stats/daily (í†µê³„)
- [ ] API ë¬¸ì„œ í™•ì¸
- [ ] í…ŒìŠ¤íŠ¸ ì‹¤í–‰

## í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´
```bash
# ë°°ì¹˜ ë™ê¸°í™”
curl -X POST http://localhost:8000/api/v1/wearables/sync \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "family_profile_id": "your-profile-id",
    "data_points": [
      {
        "data_type": "steps",
        "value": 8532,
        "unit": "steps",
        "start_time": "2025-12-07T00:00:00Z",
        "source": "apple_health"
      },
      {
        "data_type": "heart_rate",
        "value": 72,
        "unit": "bpm",
        "start_time": "2025-12-07T09:00:00Z",
        "source": "apple_health"
      }
    ]
  }'

# ì›¨ì–´ëŸ¬ë¸” ë°ì´í„° ì¡°íšŒ
curl -X GET "http://localhost:8000/api/v1/wearables/profiles/{profile_id}?data_type=steps&days=7" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"

# ì¼ì¼ í†µê³„ ì¡°íšŒ
curl -X GET "http://localhost:8000/api/v1/wearables/profiles/{profile_id}/stats/daily?data_type=steps&date=2025-12-07" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

## ë³´ê³ ì„œ ì‘ì„±
Day 32-35 ì™„ë£Œ í›„ ë‹¤ìŒì„ ë³´ê³ í•´ì¤˜:
1. ì‘ì„±ëœ íŒŒì¼ ëª©ë¡
2. API ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡
3. ë°°ì¹˜ ë™ê¸°í™” í…ŒìŠ¤íŠ¸ ê²°ê³¼
4. ì¤‘ë³µ ë°ì´í„° ì œê±° ë™ì‘ í™•ì¸
5. ë‹¤ìŒ ë‹¨ê³„ ì¤€ë¹„ ìƒíƒœ

ì™„ë£Œí–ˆìœ¼ë©´ "Day 32-35 ì™„ë£Œ ë³´ê³ ì„œ"ë¥¼ ì‘ì„±í•´ì¤˜.
```

---

## ğŸ“ Week 5-6 ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

Day 29-42ë¥¼ ëª¨ë‘ ì™„ë£Œí•˜ë©´ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

### Backend
- âœ… ê±´ê°• ë°ì´í„° ëª¨ë¸ (HealthData)
- âœ… ì›¨ì–´ëŸ¬ë¸” ë°ì´í„° ëª¨ë¸ (WearableData)
- âœ… ê±´ê°• ë°ì´í„° CRUD API
- âœ… ì›¨ì–´ëŸ¬ë¸” ë°ì´í„° ë°°ì¹˜ ë™ê¸°í™” API
- âœ… ì¼ì¼/ì£¼ê°„ í†µê³„ API
- âœ… ì¤‘ë³µ ë°ì´í„° ìë™ ì œê±° ë¡œì§

### API ì—”ë“œí¬ì¸íŠ¸ (ì¶”ê°€ 6ê°œ)
```
POST   /api/v1/health
GET    /api/v1/health/profiles/{id}
PATCH  /api/v1/health/{id}
DELETE /api/v1/health/{id}
POST   /api/v1/wearables/sync
GET    /api/v1/wearables/profiles/{id}
GET    /api/v1/wearables/profiles/{id}/stats/daily
```

### ë‹¤ìŒ ë‹¨ê³„
Day 43-52ë¡œ ì´ë™: RevenueCat êµ¬ë… ì‹œìŠ¤í…œ & Flutter UI êµ¬í˜„

---

**ì´ ë¬¸ì„œëŠ” Claude Code ê°œë°œ í”„ë¡¬í”„íŠ¸ v1.3ì˜ Day 29-42 ë¶€ë¶„ì…ë‹ˆë‹¤.**  
**ì „ì²´ ë¬¸ì„œ: Claude_Code_ê°œë°œ_í”„ë¡¬í”„íŠ¸_ì™„ì „íŒ_v1_3.md**
