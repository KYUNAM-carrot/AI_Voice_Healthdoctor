# Day 9-14: ê°€ì¡± í”„ë¡œí•„ ê´€ë¦¬ ì™„ì „ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ì´ ì„¹ì…˜ì€ Claude Code ê°œë°œ í”„ë¡¬í”„íŠ¸ v1.3ì˜ **Day 9-14: ê°€ì¡± í”„ë¡œí•„ ê´€ë¦¬** ë¶€ë¶„ì…ë‹ˆë‹¤.

**ì°¸ì¡° ë¬¸ì„œ:**
- ê°œë°œ_ì²´í¬ë¦¬ìŠ¤íŠ¸_v1.3.md: Day 11-14 (Lines 135-144)
- TRD v1.3: ì„¹ì…˜ 4.2 (Family Profiles í…Œì´ë¸”)
- PRD v1.3: ì„¹ì…˜ 4.1 (ê°€ì¡± í”„ë¡œí•„ ê´€ë¦¬ ê¸°ëŠ¥)

---

## Day 9-10: User Service êµ¬í˜„

### ëª©í‘œ
ì‚¬ìš©ì í”„ë¡œí•„ CRUD APIë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

### Claude Code í”„ë¡¬í”„íŠ¸

```markdown
# Day 9-10: User Service êµ¬í˜„

## ëª©í‘œ
ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ ë° ìˆ˜ì • APIë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

## 1. core_api/schemas/user.py ì‘ì„±

```python
from pydantic import BaseModel, EmailStr
from typing import Optional
from datetime import datetime

class UserUpdate(BaseModel):
    name: Optional[str] = None
    notification_enabled: Optional[bool] = None
    push_token: Optional[str] = None
    
    class Config:
        json_schema_extra = {
            "example": {
                "name": "í™ê¸¸ë™",
                "notification_enabled": True,
                "push_token": "fcm_token_here"
            }
        }

class UserResponse(BaseModel):
    id: str
    social_provider: str
    email: Optional[str] = None
    name: Optional[str] = None
    profile_image_url: Optional[str] = None
    notification_enabled: bool
    created_at: datetime
    updated_at: datetime
    last_login_at: Optional[datetime] = None
    
    class Config:
        from_attributes = True
```

## 2. core_api/services/user_service.py ì‘ì„±

```python
from sqlalchemy.orm import Session
from core_api.models.user import User
from core_api.schemas.user import UserUpdate
from typing import Optional

class UserService:
    """ì‚¬ìš©ì ì„œë¹„ìŠ¤"""
    
    @staticmethod
    def get_user(db: Session, user_id: str) -> Optional[User]:
        """ì‚¬ìš©ì ì¡°íšŒ"""
        return db.query(User).filter(User.id == user_id).first()
    
    @staticmethod
    def update_user(
        db: Session,
        user: User,
        update_data: UserUpdate
    ) -> User:
        """ì‚¬ìš©ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸"""
        update_dict = update_data.dict(exclude_unset=True)
        
        for key, value in update_dict.items():
            setattr(user, key, value)
        
        db.commit()
        db.refresh(user)
        
        return user
```

## 3. core_api/routers/users.py ì‘ì„±

```python
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session
from core_api.database import get_db
from core_api.schemas.user import UserResponse, UserUpdate
from core_api.services.user_service import UserService
from core_api.dependencies import get_current_active_user
from core_api.models.user import User

router = APIRouter(prefix="/api/v1/users", tags=["Users"])

@router.get("/me", response_model=UserResponse)
async def get_my_profile(
    current_user: User = Depends(get_current_active_user)
):
    """
    í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ í”„ë¡œí•„ ì¡°íšŒ
    """
    return UserResponse.from_orm(current_user)

@router.patch("/me", response_model=UserResponse)
async def update_my_profile(
    update_data: UserUpdate,
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """
    í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ í”„ë¡œí•„ ìˆ˜ì •
    
    - name: ì´ë¦„
    - notification_enabled: ì•Œë¦¼ ì„¤ì •
    - push_token: FCM í‘¸ì‹œ í† í°
    """
    updated_user = UserService.update_user(db, current_user, update_data)
    return UserResponse.from_orm(updated_user)

@router.delete("/me", status_code=status.HTTP_204_NO_CONTENT)
async def delete_my_account(
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """
    í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ê³„ì • ì‚­ì œ
    
    - ê°€ì¡± í”„ë¡œí•„, êµ¬ë…, ëŒ€í™” ì´ë ¥ ëª¨ë‘ ì‚­ì œ (CASCADE)
    """
    db.delete(current_user)
    db.commit()
    
    return None
```

## 4. core_api/main.py ë¼ìš°í„° ë“±ë¡

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from core_api.config import settings
from core_api.routers import auth, users  # users ì¶”ê°€

app = FastAPI(
    title="HealthAI Core API",
    version="1.0.0",
    description="Core API for Voice AI Health Doctor App"
)

# CORS ì„¤ì •
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# ë¼ìš°í„° ë“±ë¡
app.include_router(auth.router)
app.include_router(users.router)  # ì¶”ê°€

@app.get("/")
async def root():
    return {"message": "HealthAI Core API is running"}

@app.get("/health")
async def health_check():
    return {"status": "healthy"}
```

## 5. í…ŒìŠ¤íŠ¸ (tests/test_users.py) ì‘ì„±

```python
import pytest
from fastapi.testclient import TestClient
from core_api.main import app
from core_api.database import Base, engine
from core_api.models import User
from core_api.services.auth_service import AuthService

client = TestClient(app)

@pytest.fixture(scope="module")
def setup_database():
    Base.metadata.create_all(bind=engine)
    yield
    Base.metadata.drop_all(bind=engine)

def test_get_me_requires_auth():
    """ì¸ì¦ ì—†ì´ /me í˜¸ì¶œ ì‹œ 403 ì—ëŸ¬"""
    response = client.get("/api/v1/users/me")
    assert response.status_code == 403

def test_update_profile_requires_auth():
    """ì¸ì¦ ì—†ì´ í”„ë¡œí•„ ìˆ˜ì • ì‹œ 403 ì—ëŸ¬"""
    response = client.patch(
        "/api/v1/users/me",
        json={"name": "í…ŒìŠ¤íŠ¸"}
    )
    assert response.status_code == 403
```

## ì™„ë£Œ ê¸°ì¤€
- [ ] core_api/schemas/user.py ì‘ì„±
- [ ] core_api/services/user_service.py ì‘ì„±
- [ ] core_api/routers/users.py ì‘ì„± (GET /me, PATCH /me, DELETE /me)
- [ ] core_api/main.pyì— ë¼ìš°í„° ë“±ë¡
- [ ] tests/test_users.py ì‘ì„±
- [ ] API ë¬¸ì„œ í™•ì¸ (http://localhost:8000/docs)
- [ ] í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì„±ê³µ

## í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´
```bash
# API ë¬¸ì„œ í™•ì¸
open http://localhost:8000/docs

# í”„ë¡œí•„ ì¡°íšŒ (JWT í† í° í•„ìš”)
curl -X GET http://localhost:8000/api/v1/users/me \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"

# í”„ë¡œí•„ ìˆ˜ì •
curl -X PATCH http://localhost:8000/api/v1/users/me \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"name": "í™ê¸¸ë™", "notification_enabled": true}'

# ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
docker-compose exec core_api pytest tests/test_users.py -v
```

## ë³´ê³ ì„œ ì‘ì„±
Day 9-10 ì™„ë£Œ í›„ ë‹¤ìŒì„ ë³´ê³ í•´ì¤˜:
1. ì‘ì„±ëœ íŒŒì¼ ëª©ë¡
2. API ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡
3. í…ŒìŠ¤íŠ¸ ê²°ê³¼
4. ë‹¤ìŒ ë‹¨ê³„ ì¤€ë¹„ ìƒíƒœ

ì™„ë£Œí–ˆìœ¼ë©´ "Day 9-10 ì™„ë£Œ ë³´ê³ ì„œ"ë¥¼ ì‘ì„±í•´ì¤˜.
```

---

## Day 11-14: Family Service êµ¬í˜„

### ëª©í‘œ
ê°€ì¡± í”„ë¡œí•„ CRUD APIì™€ í”„ë¡œí•„ ê°œìˆ˜ ì œí•œ ë¡œì§ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

### ì°¸ì¡° ë¬¸ì„œ
- ê°œë°œ_ì²´í¬ë¦¬ìŠ¤íŠ¸_v1.3.md: Day 11-14 (Lines 135-144)
- TRD v1.3: ì„¹ì…˜ 4.2 (Family Profiles í…Œì´ë¸”)
- PRD v1.3: ì„¹ì…˜ 6.1 (êµ¬ë… í”Œëœë³„ ê¸°ëŠ¥)

### Claude Code í”„ë¡¬í”„íŠ¸

```markdown
# Day 11-14: Family Service êµ¬í˜„

## ëª©í‘œ
ê°€ì¡± í”„ë¡œí•„ CRUD APIë¥¼ êµ¬í˜„í•˜ê³ , êµ¬ë… í”Œëœë³„ í”„ë¡œí•„ ê°œìˆ˜ ì œí•œì„ ì ìš©í•©ë‹ˆë‹¤.

## êµ¬ë… í”Œëœë³„ ì œí•œ (PRD v1.3 ì°¸ì¡°)
- **FREE:** ê°€ì¡± í”„ë¡œí•„ 2ê°œ
- **BASIC:** ê°€ì¡± í”„ë¡œí•„ 5ê°œ
- **PREMIUM:** ê°€ì¡± í”„ë¡œí•„ ë¬´ì œí•œ
- **FAMILY:** ê°€ì¡± í”„ë¡œí•„ ë¬´ì œí•œ

## 1. core_api/schemas/family.py ì‘ì„±

```python
from pydantic import BaseModel, validator
from typing import Optional, List
from datetime import date, datetime

class FamilyProfileCreate(BaseModel):
    name: str
    nickname: Optional[str] = None
    relationship: str  # "self", "spouse", "parent", "child", etc.
    birth_date: Optional[date] = None
    gender: str  # "male", "female", "other"
    phone_number: Optional[str] = None
    height: Optional[str] = None  # "170cm"
    weight: Optional[str] = None  # "65kg"
    blood_type: Optional[str] = None  # "A+", "O-"
    chronic_conditions: Optional[List[str]] = None  # ["ë‹¹ë‡¨", "ê³ í˜ˆì••"]
    allergies: Optional[List[str]] = None  # ["í˜ë‹ˆì‹¤ë¦°", "ë•…ì½©"]
    medications: Optional[List[str]] = None  # ["ë©”íŠ¸í¬ë¥´ë¯¼", "ì•„ìŠ¤í”¼ë¦°"]
    
    @validator('name')
    def validate_name(cls, v):
        if not v or len(v.strip()) == 0:
            raise ValueError('Name cannot be empty')
        if len(v) > 100:
            raise ValueError('Name too long (max 100 characters)')
        return v
    
    @validator('gender')
    def validate_gender(cls, v):
        if v not in ['male', 'female', 'other']:
            raise ValueError('Invalid gender')
        return v
    
    @validator('relationship')
    def validate_relationship(cls, v):
        valid_relationships = [
            'self', 'spouse', 'parent', 'child', 
            'sibling', 'grandparent', 'grandchild', 'other'
        ]
        if v not in valid_relationships:
            raise ValueError(f'Invalid relationship. Must be one of: {valid_relationships}')
        return v
    
    class Config:
        json_schema_extra = {
            "example": {
                "name": "ê¹€ì˜í¬",
                "nickname": "ì—„ë§ˆ",
                "relationship": "parent",
                "birth_date": "1965-03-15",
                "gender": "female",
                "chronic_conditions": ["ê³ í˜ˆì••", "ë‹¹ë‡¨"],
                "allergies": ["í˜ë‹ˆì‹¤ë¦°"],
                "medications": ["ë©”íŠ¸í¬ë¥´ë¯¼ 500mg"]
            }
        }

class FamilyProfileUpdate(BaseModel):
    name: Optional[str] = None
    nickname: Optional[str] = None
    phone_number: Optional[str] = None
    height: Optional[str] = None
    weight: Optional[str] = None
    blood_type: Optional[str] = None
    chronic_conditions: Optional[List[str]] = None
    allergies: Optional[List[str]] = None
    medications: Optional[List[str]] = None
    
    class Config:
        json_schema_extra = {
            "example": {
                "height": "165cm",
                "weight": "58kg",
                "medications": ["ë©”íŠ¸í¬ë¥´ë¯¼ 500mg", "ì•„ìŠ¤í”¼ë¦° 100mg"]
            }
        }

class FamilyProfileResponse(BaseModel):
    id: str
    user_id: str
    name: str
    nickname: Optional[str] = None
    relationship: str
    birth_date: Optional[date] = None
    gender: str
    phone_number: Optional[str] = None
    height: Optional[str] = None
    weight: Optional[str] = None
    blood_type: Optional[str] = None
    chronic_conditions: Optional[List[str]] = None
    allergies: Optional[List[str]] = None
    medications: Optional[List[str]] = None
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True
```

## 2. core_api/services/family_service.py ì‘ì„±

```python
from sqlalchemy.orm import Session
from core_api.models.family import FamilyProfile
from core_api.models.user import User
from core_api.models.subscription import Subscription, SubscriptionPlan
from core_api.schemas.family import FamilyProfileCreate, FamilyProfileUpdate
from typing import List, Optional
from fastapi import HTTPException, status
import json

class FamilyService:
    """ê°€ì¡± í”„ë¡œí•„ ì„œë¹„ìŠ¤"""
    
    # êµ¬ë… í”Œëœë³„ í”„ë¡œí•„ ê°œìˆ˜ ì œí•œ
    PROFILE_LIMITS = {
        SubscriptionPlan.FREE: 2,
        SubscriptionPlan.BASIC: 5,
        SubscriptionPlan.PREMIUM: 999,  # ë¬´ì œí•œ
        SubscriptionPlan.FAMILY: 999    # ë¬´ì œí•œ
    }
    
    @staticmethod
    def check_profile_limit(db: Session, user: User) -> None:
        """
        ì‚¬ìš©ìì˜ êµ¬ë… í”Œëœì— ë”°ë¥¸ í”„ë¡œí•„ ê°œìˆ˜ ì œí•œ í™•ì¸
        
        Raises:
            HTTPException: í”„ë¡œí•„ ê°œìˆ˜ ì œí•œ ì´ˆê³¼ ì‹œ
        """
        # í˜„ì¬ í™œì„± êµ¬ë… ì¡°íšŒ
        subscription = db.query(Subscription).filter(
            Subscription.user_id == user.id,
            Subscription.status.in_(["active", "trial"])
        ).first()
        
        plan = subscription.plan if subscription else SubscriptionPlan.FREE
        limit = FamilyService.PROFILE_LIMITS.get(plan, 2)
        
        # í˜„ì¬ í”„ë¡œí•„ ê°œìˆ˜
        current_count = db.query(FamilyProfile).filter(
            FamilyProfile.user_id == user.id
        ).count()
        
        if current_count >= limit:
            raise HTTPException(
                status_code=status.HTTP_403_FORBIDDEN,
                detail=f"Profile limit reached. {plan.value} plan allows {limit} profiles. Upgrade to add more."
            )
    
    @staticmethod
    def create_profile(
        db: Session,
        user: User,
        profile_data: FamilyProfileCreate
    ) -> FamilyProfile:
        """ê°€ì¡± í”„ë¡œí•„ ìƒì„±"""
        # í”„ë¡œí•„ ê°œìˆ˜ ì œí•œ í™•ì¸
        FamilyService.check_profile_limit(db, user)
        
        # JSON ë°°ì—´ ë³€í™˜
        chronic_conditions_json = json.dumps(profile_data.chronic_conditions or [], ensure_ascii=False)
        allergies_json = json.dumps(profile_data.allergies or [], ensure_ascii=False)
        medications_json = json.dumps(profile_data.medications or [], ensure_ascii=False)
        
        new_profile = FamilyProfile(
            user_id=user.id,
            name=profile_data.name,
            nickname=profile_data.nickname,
            relationship=profile_data.relationship,
            birth_date=profile_data.birth_date,
            gender=profile_data.gender,
            phone_number=profile_data.phone_number,
            height=profile_data.height,
            weight=profile_data.weight,
            blood_type=profile_data.blood_type,
            chronic_conditions=chronic_conditions_json,
            allergies=allergies_json,
            medications=medications_json
        )
        
        db.add(new_profile)
        db.commit()
        db.refresh(new_profile)
        
        return new_profile
    
    @staticmethod
    def get_profiles(db: Session, user: User) -> List[FamilyProfile]:
        """ì‚¬ìš©ìì˜ ëª¨ë“  ê°€ì¡± í”„ë¡œí•„ ì¡°íšŒ"""
        return db.query(FamilyProfile).filter(
            FamilyProfile.user_id == user.id
        ).all()
    
    @staticmethod
    def get_profile(
        db: Session,
        user: User,
        profile_id: str
    ) -> Optional[FamilyProfile]:
        """íŠ¹ì • ê°€ì¡± í”„ë¡œí•„ ì¡°íšŒ"""
        profile = db.query(FamilyProfile).filter(
            FamilyProfile.id == profile_id,
            FamilyProfile.user_id == user.id
        ).first()
        
        if not profile:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="Profile not found"
            )
        
        return profile
    
    @staticmethod
    def update_profile(
        db: Session,
        profile: FamilyProfile,
        update_data: FamilyProfileUpdate
    ) -> FamilyProfile:
        """ê°€ì¡± í”„ë¡œí•„ ì—…ë°ì´íŠ¸"""
        update_dict = update_data.dict(exclude_unset=True)
        
        # JSON ë°°ì—´ ë³€í™˜
        if 'chronic_conditions' in update_dict and update_dict['chronic_conditions'] is not None:
            update_dict['chronic_conditions'] = json.dumps(update_dict['chronic_conditions'], ensure_ascii=False)
        if 'allergies' in update_dict and update_dict['allergies'] is not None:
            update_dict['allergies'] = json.dumps(update_dict['allergies'], ensure_ascii=False)
        if 'medications' in update_dict and update_dict['medications'] is not None:
            update_dict['medications'] = json.dumps(update_dict['medications'], ensure_ascii=False)
        
        for key, value in update_dict.items():
            setattr(profile, key, value)
        
        db.commit()
        db.refresh(profile)
        
        return profile
    
    @staticmethod
    def delete_profile(db: Session, profile: FamilyProfile) -> None:
        """ê°€ì¡± í”„ë¡œí•„ ì‚­ì œ"""
        db.delete(profile)
        db.commit()
```

## 3. core_api/routers/families.py ì‘ì„±

```python
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session
from core_api.database import get_db
from core_api.schemas.family import (
    FamilyProfileCreate,
    FamilyProfileUpdate,
    FamilyProfileResponse
)
from core_api.services.family_service import FamilyService
from core_api.dependencies import get_current_active_user
from core_api.models.user import User
from typing import List
import json

router = APIRouter(prefix="/api/v1/families", tags=["Family Profiles"])

def parse_json_fields(profile) -> dict:
    """JSON ë¬¸ìì—´ í•„ë“œë¥¼ íŒŒì´ì¬ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜"""
    profile_dict = {
        **profile.__dict__,
        "chronic_conditions": json.loads(profile.chronic_conditions) if profile.chronic_conditions else [],
        "allergies": json.loads(profile.allergies) if profile.allergies else [],
        "medications": json.loads(profile.medications) if profile.medications else []
    }
    return profile_dict

@router.get("", response_model=List[FamilyProfileResponse])
async def get_family_profiles(
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """
    í˜„ì¬ ì‚¬ìš©ìì˜ ëª¨ë“  ê°€ì¡± í”„ë¡œí•„ ì¡°íšŒ
    """
    profiles = FamilyService.get_profiles(db, current_user)
    
    # JSON í•„ë“œ íŒŒì‹±
    return [parse_json_fields(p) for p in profiles]

@router.post("", response_model=FamilyProfileResponse, status_code=status.HTTP_201_CREATED)
async def create_family_profile(
    profile_data: FamilyProfileCreate,
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """
    ìƒˆë¡œìš´ ê°€ì¡± í”„ë¡œí•„ ìƒì„±
    
    - êµ¬ë… í”Œëœì— ë”°ë¼ í”„ë¡œí•„ ê°œìˆ˜ ì œí•œ ì ìš©
    - FREE: 2ê°œ, BASIC: 5ê°œ, PREMIUM/FAMILY: ë¬´ì œí•œ
    """
    new_profile = FamilyService.create_profile(db, current_user, profile_data)
    return parse_json_fields(new_profile)

@router.get("/{profile_id}", response_model=FamilyProfileResponse)
async def get_family_profile(
    profile_id: str,
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """
    íŠ¹ì • ê°€ì¡± í”„ë¡œí•„ ì¡°íšŒ
    """
    profile = FamilyService.get_profile(db, current_user, profile_id)
    return parse_json_fields(profile)

@router.patch("/{profile_id}", response_model=FamilyProfileResponse)
async def update_family_profile(
    profile_id: str,
    update_data: FamilyProfileUpdate,
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """
    ê°€ì¡± í”„ë¡œí•„ ìˆ˜ì •
    """
    profile = FamilyService.get_profile(db, current_user, profile_id)
    updated_profile = FamilyService.update_profile(db, profile, update_data)
    return parse_json_fields(updated_profile)

@router.delete("/{profile_id}", status_code=status.HTTP_204_NO_CONTENT)
async def delete_family_profile(
    profile_id: str,
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """
    ê°€ì¡± í”„ë¡œí•„ ì‚­ì œ
    
    - ê´€ë ¨ëœ ê±´ê°• ë°ì´í„°, ëŒ€í™” ì´ë ¥ë„ í•¨ê»˜ ì‚­ì œ (CASCADE)
    """
    profile = FamilyService.get_profile(db, current_user, profile_id)
    FamilyService.delete_profile(db, profile)
    
    return None
```

## 4. core_api/main.py ë¼ìš°í„° ë“±ë¡

```python
from core_api.routers import auth, users, families  # families ì¶”ê°€

# ë¼ìš°í„° ë“±ë¡
app.include_router(auth.router)
app.include_router(users.router)
app.include_router(families.router)  # ì¶”ê°€
```

## 5. í…ŒìŠ¤íŠ¸ (tests/test_families.py) ì‘ì„±

```python
import pytest
from fastapi.testclient import TestClient
from core_api.main import app
from core_api.database import Base, engine

client = TestClient(app)

@pytest.fixture(scope="module")
def setup_database():
    Base.metadata.create_all(bind=engine)
    yield
    Base.metadata.drop_all(bind=engine)

def test_get_families_requires_auth():
    """ì¸ì¦ ì—†ì´ ê°€ì¡± í”„ë¡œí•„ ì¡°íšŒ ì‹œ 403 ì—ëŸ¬"""
    response = client.get("/api/v1/families")
    assert response.status_code == 403

def test_create_family_requires_auth():
    """ì¸ì¦ ì—†ì´ ê°€ì¡± í”„ë¡œí•„ ìƒì„± ì‹œ 403 ì—ëŸ¬"""
    response = client.post(
        "/api/v1/families",
        json={
            "name": "í…ŒìŠ¤íŠ¸",
            "relationship": "self",
            "gender": "male"
        }
    )
    assert response.status_code == 403
```

## ì™„ë£Œ ê¸°ì¤€
- [ ] core_api/schemas/family.py ì‘ì„±
- [ ] core_api/services/family_service.py ì‘ì„±
  - [ ] í”„ë¡œí•„ ê°œìˆ˜ ì œí•œ ë¡œì§
  - [ ] CRUD ë©”ì„œë“œ (create, get_all, get_one, update, delete)
- [ ] core_api/routers/families.py ì‘ì„±
  - [ ] GET /api/v1/families (ëª©ë¡)
  - [ ] POST /api/v1/families (ìƒì„±)
  - [ ] GET /api/v1/families/{id} (ì¡°íšŒ)
  - [ ] PATCH /api/v1/families/{id} (ìˆ˜ì •)
  - [ ] DELETE /api/v1/families/{id} (ì‚­ì œ)
- [ ] core_api/main.pyì— ë¼ìš°í„° ë“±ë¡
- [ ] tests/test_families.py ì‘ì„±
- [ ] API ë¬¸ì„œ í™•ì¸ (http://localhost:8000/docs)
- [ ] í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì„±ê³µ

## í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´
```bash
# ê°€ì¡± í”„ë¡œí•„ ëª©ë¡ ì¡°íšŒ
curl -X GET http://localhost:8000/api/v1/families \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"

# ê°€ì¡± í”„ë¡œí•„ ìƒì„±
curl -X POST http://localhost:8000/api/v1/families \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "ê¹€ì˜í¬",
    "nickname": "ì—„ë§ˆ",
    "relationship": "parent",
    "birth_date": "1965-03-15",
    "gender": "female",
    "chronic_conditions": ["ê³ í˜ˆì••", "ë‹¹ë‡¨"],
    "medications": ["ë©”íŠ¸í¬ë¥´ë¯¼ 500mg"]
  }'

# í”„ë¡œí•„ ê°œìˆ˜ ì œí•œ í…ŒìŠ¤íŠ¸ (FREE í”Œëœ: 2ê°œ ì œí•œ)
# 3ë²ˆì§¸ í”„ë¡œí•„ ìƒì„± ì‹œë„ â†’ 403 ì—ëŸ¬ ì˜ˆìƒ

# ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
docker-compose exec core_api pytest tests/test_families.py -v
```

## í”„ë¡œí•„ ê°œìˆ˜ ì œí•œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
1. ìƒˆ ì‚¬ìš©ì ìƒì„± (FREE í”Œëœ, 14ì¼ ë¬´ë£Œ ì²´í—˜)
2. ê°€ì¡± í”„ë¡œí•„ 1ê°œ ìƒì„± â†’ ì„±ê³µ
3. ê°€ì¡± í”„ë¡œí•„ 2ê°œ ìƒì„± â†’ ì„±ê³µ
4. ê°€ì¡± í”„ë¡œí•„ 3ê°œ ìƒì„± ì‹œë„ â†’ 403 ì—ëŸ¬:
   ```json
   {
     "detail": "Profile limit reached. free plan allows 2 profiles. Upgrade to add more."
   }
   ```

## ë³´ê³ ì„œ ì‘ì„±
Day 11-14 ì™„ë£Œ í›„ ë‹¤ìŒì„ ë³´ê³ í•´ì¤˜:
1. ì‘ì„±ëœ íŒŒì¼ ëª©ë¡
2. API ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡ (ì „ì²´ 5ê°œ)
3. í”„ë¡œí•„ ê°œìˆ˜ ì œí•œ ë¡œì§ í…ŒìŠ¤íŠ¸ ê²°ê³¼
4. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ê²°ê³¼
5. API ë¬¸ì„œ ìŠ¤í¬ë¦°ìƒ·
6. ë‹¤ìŒ ë‹¨ê³„ ì¤€ë¹„ ìƒíƒœ

ì™„ë£Œí–ˆìœ¼ë©´ "Day 11-14 ì™„ë£Œ ë³´ê³ ì„œ"ë¥¼ ì‘ì„±í•´ì¤˜.
```

---

## ğŸ“ Week 1-2 ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

Day 1-14ë¥¼ ëª¨ë‘ ì™„ë£Œí•˜ë©´ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

### Backend
- âœ… í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒì„± (Core API + Conversation Service)
- âœ… Docker Compose ë¡œì»¬ í™˜ê²½ êµ¬ì¶•
- âœ… PostgreSQL + Redis ì„¤ì •
- âœ… SQLAlchemy ëª¨ë¸ (User, FamilyProfile, Subscription)
- âœ… Alembic ë§ˆì´ê·¸ë ˆì´ì…˜
- âœ… JWT ì¸ì¦ ì‹œìŠ¤í…œ
- âœ… ì†Œì…œ ë¡œê·¸ì¸ (ì¹´ì¹´ì˜¤, êµ¬ê¸€, ì• í”Œ)
- âœ… User API (GET /me, PATCH /me, DELETE /me)
- âœ… Family API (CRUD ì „ì²´)
- âœ… êµ¬ë… í”Œëœë³„ í”„ë¡œí•„ ê°œìˆ˜ ì œí•œ

### API ì—”ë“œí¬ì¸íŠ¸ (ì´ 10ê°œ)
```
POST   /api/v1/auth/login/social
GET    /api/v1/auth/me
POST   /api/v1/auth/refresh
GET    /api/v1/users/me
PATCH  /api/v1/users/me
DELETE /api/v1/users/me
GET    /api/v1/families
POST   /api/v1/families
GET    /api/v1/families/{id}
PATCH  /api/v1/families/{id}
DELETE /api/v1/families/{id}
```

### ë‹¤ìŒ ë‹¨ê³„
Week 3-4ë¡œ ì´ë™: OpenAI Realtime API í†µí•© ë° AI ìºë¦­í„° ì‹œìŠ¤í…œ êµ¬í˜„

---

**ì´ ë¬¸ì„œëŠ” Claude Code ê°œë°œ í”„ë¡¬í”„íŠ¸ v1.3ì˜ Day 9-14 ë¶€ë¶„ì…ë‹ˆë‹¤.**  
**ì „ì²´ ë¬¸ì„œ: Claude_Code_ê°œë°œ_í”„ë¡¬í”„íŠ¸_ì™„ì „íŒ_v1_3.md**
